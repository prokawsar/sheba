{"version":3,"file":"chunk-988ddd89.js","sources":["../../../src/components/helpers/DataSort.html","../../../src/components/helpers/DataList.html"],"sourcesContent":["<div class=\"sorting-filters\">\r\n  <div class=\"field is-grouped\">\r\n    <div class=\"control\">\r\n      <small>Sort By:</small>\r\n    </div>\r\n    <div class=\"control\">\r\n      <div class=\"select is-small\">\r\n        <select class=\"is-fullwidth\" on:change=\"fire('sort', value)\" bind:value>\r\n          <option value=\"\">Default</option>\r\n          {#each options as opt}\r\n            <option value=\"{opt.value}\">{opt.name}</option>\r\n          {/each}\r\n        </select>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n\r\n<script>\r\n\r\n  export default {\r\n    data(){\r\n      return {\r\n        options: [],\r\n        sort:'',\r\n        value:''\r\n      }\r\n    },\r\n    onstate({changed, current}){\r\n      if(changed.sort){\r\n        this.set({value: current.sort.replace('%20', ' ')});\r\n      }\r\n    }\r\n  }\r\n\r\n</script>","\r\n{#if is_paginating}\r\n<div class=\"is-overlay\">\r\n  <Loader />\r\n</div>\r\n{/if}\r\n\r\n\r\n{#if has_search}\r\n<div class=\"columns search-area\">\r\n<div class=\"column\">\r\n  <DataSearch\r\n    hasSearch={show_search_box}\r\n    hasFilters={show_filters}\r\n    placeholder=\"{search_placeholder}\"\r\n    bind:filters=\"meta.filters\"\r\n    {q}\r\n    on:search\r\n    on:resetSearch\r\n    {filterComponent}\r\n    {filter_not_in_use_class}\r\n    {filter_in_use_class}\r\n    {filter_label_map}\r\n  />\r\n</div>\r\n{#if has_additional_buttons}\r\n<div class=\"column is-narrow\">\r\n  <slot name=\"additionalButtons\"></slot>\r\n</div>\r\n{/if}\r\n</div>\r\n{/if}\r\n{#if meta.sort}\r\n<DataSort options={meta.sort} {sort} on:sort />\r\n{/if}\r\n\r\n\r\n<ViewHOC target={targetview}\r\n  on:*=\"fire('_forwardEvent', event)\"\r\n  transition=\"{has_transition}\"\r\n  {iteration_key}\r\n  {data} {columns} {per_row}\r\n  {valueTransformers} {classTransformers} {styleTransformers} {visibilityMap}\r\n  {tileItemComponent}\r\n  {cellComponentMap}\r\n  {rowComponent}\r\n  {clickableRows}\r\n/>\r\n{#if has_pagination}\r\n  <Pagination {meta} entityName=\"{entity_name}\" on:paginate on:setLimit />\r\n{/if}\r\n\r\n<script>\r\n\r\nimport Router from '../../services/router.js';\r\nimport {Loader, createHOC} from '@kws3/helpers';\r\nimport {GridView, TileView, DataSearch, Pagination} from '@kws3/datagrid';\r\nimport DataSort from './DataSort.html';\r\n\r\nexport default {\r\n  components:{\r\n    ViewHOC: createHOC(),\r\n    Loader, DataSearch, Pagination,\r\n    DataSort\r\n  },\r\n  data(){\r\n    return {\r\n      _GridView: GridView, _TileView: TileView,\r\n      customView: null,\r\n      iteration_key:'id',\r\n      Router:null,\r\n      Model: null,\r\n      View:null,\r\n      route_prefix: '',\r\n      sort_param_index: 2,\r\n      q_param_index: 1,\r\n      offset_param_index: 0,\r\n      limit:20,\r\n      entity_name: 'entries',\r\n      view_type: 'grid',\r\n      tileItemComponent: null,\r\n      rowComponent: null,\r\n      filterComponent: null,\r\n      has_search: true,\r\n      show_search_box: true,\r\n      show_filters: true,\r\n      search_placeholder: 'Search',\r\n      has_pagination: true,\r\n      has_additional_buttons: false,\r\n      filter_in_use_class:'is-in-use',\r\n      filter_not_in_use_class:'is-not-in-use',\r\n      filter_label_map:{},\r\n      is_striped: true,\r\n      per_row: 3,\r\n      is_loading: true,\r\n      is_error: false,\r\n      error_message:'',\r\n      is_paginating: false,\r\n      sort:'',\r\n      q:'',\r\n      meta:{},\r\n      data:[],\r\n      response: [],\r\n      columns:{},\r\n      searchStringTransformer: (q) => '',\r\n      responseTransformer: (d) =>  d,\r\n      requestTransformer: (Model, opts) => Model.getAll(opts),\r\n      valueTransformers:{},\r\n      classTransformers:{},\r\n      styleTransformers:{},\r\n      visibilityMap:{},\r\n      cellComponentMap:{},\r\n      clickableRows: false,\r\n    }\r\n  },\r\n  computed:{\r\n    has_transition({ $settings, transition }){\r\n      if(typeof transition != 'undefined'){\r\n        return transition;\r\n      }else{\r\n        return $settings.transition;\r\n      }\r\n    },\r\n    targetview({view_type, customView, _TileView, _GridView}){\r\n      var target = customView;\r\n      if(view_type == 'tile'){\r\n        target = _TileView;\r\n      }\r\n      else if(view_type == 'grid'){\r\n        target = _GridView;\r\n      }\r\n      return target;\r\n    },\r\n  },\r\n  oncreate(){\r\n    this.on('_forwardEvent', (e) => {\r\n      this.fire(e.name, e.event);\r\n    });\r\n\r\n    this.init();\r\n  },\r\n  methods:{\r\n    init(){\r\n      this.setCurrentQuery();\r\n\r\n      this.on('setLimit', (payload) => {\r\n        this.set({limit: payload.newLimit});\r\n        if(payload.currentPage > 0){\r\n          this.fire('paginate', {offset: 0});\r\n        }else{\r\n          this.getAll();\r\n        }\r\n      });\r\n\r\n      this.on('sort', (payload) => {\r\n        let { route_prefix, q } = this.get();\r\n        q = q.replace('%', '');\r\n\r\n        //we have clear data here otherwise items will not reorder due to svelte's keyed-list rendering\r\n        this.set({data: []})\r\n\r\n        this.getRouter().navigate(route_prefix + '0/' + q + '/' + payload);\r\n      });\r\n\r\n      this.on('paginate', (payload) => {\r\n        let { route_prefix, q, sort } = this.get();\r\n        q = q.replace('%', '');\r\n        this.getRouter().navigate(route_prefix + payload['offset'] + '/' + q + '/' + sort);\r\n      });\r\n\r\n      this.on('search', (q) => {\r\n        if(q != ''){\r\n          let { route_prefix, sort } = this.get();\r\n          q = q.replace('%', '');\r\n          this.getRouter().navigate(route_prefix + '0/' + q + '/' + sort);\r\n        }\r\n      });\r\n      this.on('resetSearch', () => {\r\n        this.getRouter().navigate(this.get().route_prefix);\r\n      });\r\n\r\n      this.store.on('state', ({ changed, current, previous }) => {\r\n        var { nav }  = current;\r\n        if (nav.activeView == this.get().View) {\r\n          this.setCurrentQuery();\r\n          this.getAll();\r\n        }\r\n      }, { init: false });\r\n\r\n      this.getAll();\r\n    },\r\n    getRouter(){\r\n      return Router || this.get().Router;\r\n    },\r\n    setCurrentQuery(){\r\n      var { nav } = this.store.get(),\r\n      {q_param_index, sort_param_index} = this.get(),\r\n      q_number = q_param_index || 1,\r\n      sort_number = sort_param_index || 2;\r\n      this.set({ q: nav && nav.params[q_number] || '', sort: nav && nav.params[sort_number] || '' });\r\n    },\r\n    getOpts(){\r\n      var { nav }  = this.store.get(),\r\n      {limit, searchStringTransformer, q_param_index, offset_param_index, sort_param_index} = this.get(),\r\n      q = ( nav && nav.params && nav.params[q_param_index]) ? nav.params[q_param_index] : '',\r\n      offset = (nav && nav.params && nav.params[offset_param_index]) ? nav.params[offset_param_index] : 0,\r\n      sort = (nav && nav.params && nav.params[sort_param_index]) ? nav.params[sort_param_index] : '',\r\n      opts = {offset, limit, q: searchStringTransformer(q), sort};\r\n\r\n      return opts;\r\n    },\r\n    getAll(){\r\n      var opts = this.getOpts();\r\n\r\n      this.set({is_paginating: true});\r\n\r\n      let { responseTransformer, requestTransformer, Model } = this.get();\r\n\r\n      requestTransformer(Model, opts)\r\n      .then((r) => {\r\n        this.set({\r\n          meta: r._meta,\r\n          data: responseTransformer(r.response),\r\n          response: r.response,\r\n          is_paginating: false,\r\n          is_loading:false,\r\n          is_error: false\r\n        });\r\n      })\r\n      .catch((r) => {\r\n        var user_message = '';\r\n        if (typeof r.response != 'undefined' && typeof r.response.records != 'undefined'){\r\n            user_message = r.response.records.userMessage;\r\n        }\r\n        this.set({\r\n          is_error: true,\r\n          error_message: user_message,\r\n          is_paginating: false,\r\n          is_loading:false\r\n        });\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>"],"names":["options","sort","value","changed","current","this","set","replace","length","fire","opt","name","createHOC","$settings","transition","view_type","customView","_TileView","_GridView","target","GridView","TileView","iteration_key","Router","Model","View","route_prefix","sort_param_index","q_param_index","offset_param_index","limit","entity_name","tileItemComponent","rowComponent","filterComponent","has_search","show_search_box","show_filters","search_placeholder","has_pagination","has_additional_buttons","filter_in_use_class","filter_not_in_use_class","filter_label_map","is_striped","per_row","is_loading","is_error","error_message","is_paginating","q","meta","data","response","columns","searchStringTransformer","responseTransformer","d","requestTransformer","opts","getAll","valueTransformers","classTransformers","styleTransformers","visibilityMap","cellComponentMap","clickableRows","[object Object]","setCurrentQuery","on","payload","newLimit","currentPage","offset","get","getRouter","navigate","store","previous","nav","activeView","init","q_number","sort_number","params","getOpts","then","r","_meta","catch","user_message","records","userMessage","e","event","targetview","has_transition","filters"],"mappings":"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"}