{"version":3,"file":"ViewRemedy.js","sources":["../../../src/components/views/remedies/ViewRemedy.html"],"sourcesContent":["<div class=\"page-content\">\r\n\r\n  <PageTitle page=\"{page}\">\r\n    <a class=\"button is-info is-inverted is-pulled-right\" href=\"#remedies\">\r\n      <Icon icon=\"long-arrow-left\" size=\"small\" />\r\n      <span>Back to All Remedies</span>\r\n    </a>\r\n  </PageTitle>\r\n\r\n  <ViewScaffold {is_loading} {is_error} {error_message}>\r\n\r\n    {#if tracker.error}\r\n      <Notification type=\"danger\">{error_message}</Notification>\r\n    {/if}\r\n\r\n    {#if !is_loading}\r\n      <form on:submit=\"fire('save', event)\">\r\n        <Panel title=\"Remedy Details\" has_toolbar={true}>\r\n          <div slot='toolbar'>\r\n            <div class=\"field\">\r\n              <div class=\"control\">\r\n                <a href=\"#remedies/singleview/{entityId}\" class=\"button is-success\">\r\n                  <Icon size=\"small\" icon=\"eye\" /><span>View on single page</span>\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"columns\">\r\n            <div class=\"column\">\r\n\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Name</label>\r\n                  <input class=\"input is-medium\" type=\"text\" required bind:value=\"data.name\" />\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <p class=\"title is-4\">Sections</p>\r\n          <div class=\"columns\">\r\n\r\n            <div class=\"column\">\r\n              <div class=\"buttons\">\r\n                {#each Object.entries(data) as [key, value], i }\r\n                  {#if !omitted_field.includes(key) }\r\n                  <button type=\"button\" class=\"button is-{ (key == selected_symptom) ? 'success' : data[key] ? '' : 'info' } \" on:click=\"select_symptom(key)\" style=\"text-transform: capitalize;\">\r\n                    {#if data[key]}\r\n                      <span class=\"icon is-small\"><i class=\"fa fa-check\"></i></span>\r\n                    {/if}\r\n                    <span>{key}</span>\r\n                  </button>\r\n                  {/if}\r\n                {/each}\r\n              </div>\r\n\r\n            </div>\r\n            <div class=\"column\">\r\n\r\n              <div class=\"field\">\r\n                <span class=\"select is-fullwidth\">\r\n                  <select class=\"input\" bind:value=\"selected_symptom\" >\r\n                    <option value=\"\">Select Type</option>\r\n                    {#each Object.entries(data) as [key, value], i}\r\n                      {#if !omitted_field.includes(key) }\r\n                        <option value=\"{key}\">{key}</option>\r\n                      {/if}\r\n                    {/each}\r\n                  </select>\r\n                </span>\r\n              </div>\r\n              \r\n              {#if is_reference }\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\" style=\"text-transform: capitalize;\">Select {selected_symptom}</label>\r\n                    <SearchableSelect\r\n                      data=\"{book_references}\"\r\n                      placeholder=\"Choose...\"\r\n                      bind:_name=\"selected_keyed_symp\"\r\n                      searchKey=\"name\"\r\n                      searchValue=\"id\"\r\n                    />\r\n                </p>\r\n              </div>\r\n              {/if}\r\n              \r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Symptoms about <span style=\"text-transform: capitalize;\">{selected_symptom} </span></label>\r\n                  <textarea class=\"textarea\" ref:input_field placeholder=\"{selected_symptom}...\" bind:value=\"data[selected_symptom]\" name=\"{selected_symptom}\" rows='10'></textarea>\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">&nbsp;</label>\r\n                  <SubmitButton classes=\"is-primary is-medium is-pulled-right\" icon=\"save\" icon_size=\"small\" text=\"Update Remedy\" bind:tracker />\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n\r\n        </Panel>\r\n      </form>\r\n    {/if}\r\n\r\n  </ViewScaffold>\r\n</div>\r\n\r\n<style>\r\n  textarea{\r\n    font-size: 17px;\r\n  }\r\n</style>\r\n\r\n<script>\r\n  import Model from '../../../models/remedies';\r\n  import {Icon, Notification, Panel, Message} from '@kws3/helpers';\r\n  import { SubmitButton } from '@kws3/buttons';\r\n  import SearchableSelect from '@kws3/searchable-select';\r\n  \r\n  export default {\r\n    components: {\r\n      ViewScaffold: '../../helpers/ViewScaffold.html',\r\n      PageTitle: '../../helpers/PageTitle.html',\r\n      Notification, SubmitButton,\r\n      Icon, Panel, SearchableSelect\r\n\r\n    },\r\n    data() {\r\n      return {\r\n        is_loading: true,\r\n        is_error: false,\r\n        error_message: '',\r\n        selected_symptom: '',\r\n        data: {},\r\n        meta: {},\r\n        omitted_field: [ 'id', 'name', 'created', 'modified', 'deleted', 'patient', 'treatments'],\r\n        book_references: [\r\n          {name: 'Condensed M.M - C. Hering', id: 'Condensed M.M - C. Hering'},\r\n          {name: 'Textbook of M.M - A. Lippe', id: 'Textbook of M.M - A. Lippe' },\r\n          {name: 'M.M Pura - S. Hahnemann', id: 'M.M Pura - S. Hahnemann' },\r\n          {name: 'Notes - Dr. Mazed', id: 'Notes - Dr. Mazed' }\r\n          \r\n        ],\r\n        tracker: {\r\n          saving: false,\r\n          saved: false,\r\n          error: false,\r\n        },\r\n        page: {\r\n          title: 'View Remedy',\r\n          subtitle: 'Modify Remedy details',\r\n          icon: 'building-o',\r\n          icon_badge: 'pencil'\r\n        },\r\n      }\r\n    },\r\n    computed: {\r\n      entityId: ({ $nav }) => $nav && $nav.params[0],\r\n      is_reference: ({selected_symptom}) => selected_symptom == 'book_references',\r\n    },\r\n    oncreate() {\r\n      var { entityId } = this.get();\r\n\r\n      this.on('state', ({ changed, current, previous }) => {\r\n        let {data, selected_symptom} = this.get()\r\n\r\n        if(current.selected_keyed_symp != previous.selected_keyed_symp){\r\n          // got it selected symptom\r\n          data[selected_symptom] =  data[selected_symptom] ? data[selected_symptom]  + ', ' + current.selected_keyed_symp : current.selected_keyed_symp;\r\n          this.set({data})\r\n        }\r\n      });\r\n\r\n      this.on('save', (e) => {\r\n        e.preventDefault();\r\n        var {data} = this.get();\r\n\r\n        if(data.name == '') return;\r\n\r\n        this.set({data});\r\n\r\n        this.save();\r\n      });\r\n\r\n      this.load();\r\n    },\r\n    methods: {\r\n      select_symptom(key){\r\n        let {input_field} = this.refs;\r\n        input_field.focus();\r\n        this.set({ selected_symptom: key })\r\n      },\r\n      load() {\r\n        var { entityId } = this.get();\r\n\r\n        this.set({\r\n          'is_loading': true,\r\n          'is_error': false\r\n        });\r\n\r\n        Model.getOne(entityId)\r\n        .then((r) => {\r\n\r\n          this.set({\r\n            'is_loading': false,\r\n            'meta': r._meta,\r\n            'data': r.response\r\n          });\r\n\r\n        })\r\n        .catch((r) => {\r\n          var user_message = '';\r\n          if (typeof r != 'undefined' && typeof r.response != 'undefined' && typeof r.response.records != 'undefined') {\r\n            user_message = r.response.records.userMessage;\r\n          }\r\n          this.set({\r\n            'is_error': true,\r\n            'is_loading': false,\r\n            'error_message': user_message\r\n          });\r\n        });\r\n      },\r\n      save() {\r\n        var {data, entityId, tracker} = this.get();\r\n\r\n        this.set({\r\n          tracker: {\r\n            saving: true,\r\n            saved: false,\r\n            error: false\r\n          }\r\n        });\r\n\r\n        Model.save(entityId, data)\r\n        .then(r => {\r\n          this.set({\r\n            data: r.response,\r\n            tracker: {\r\n              saving: false,\r\n              saved: true,\r\n              error: false\r\n            }\r\n          });\r\n\r\n          setTimeout(() => {\r\n            tracker.saved = false;\r\n            this.set({tracker});\r\n          }, 1500);\r\n        })\r\n        .catch(r => {\r\n          this.set({error_message: 'There was an error updating remedy'});\r\n\r\n          this.set({\r\n            tracker: {\r\n              saving: false,\r\n              saved: false,\r\n              error: true\r\n            }\r\n          });\r\n\r\n          setTimeout(() => {\r\n            this.set({tracker: {error: false}});\r\n          }, 1500);\r\n        });\r\n      }\r\n    }\r\n  }\r\n</script>"],"names":["$nav","params","selected_symptom","is_loading","is_error","error_message","data","meta","omitted_field","book_references","name","id","tracker","saving","saved","error","page","title","subtitle","icon","icon_badge","[object Object]","key","input_field","this","refs","focus","set","entityId","get","Model","getOne","then","r","_meta","response","catch","user_message","records","userMessage","save","setTimeout","on","changed","current","previous","selected_keyed_symp","e","preventDefault","load","select_symptom","Object","entries","length","fire","event","is_reference","includes"],"mappings":"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"}