{"version":3,"file":"AddUser.js","sources":["../../../src/components/views/AddUser.html"],"sourcesContent":["<div class=\"page-content\">\r\n\r\n  <PageTitle page=\"{page}\">\r\n    <a class=\"button is-info is-pulled-right\" href=\"#users\">\r\n      <Icon icon=\"long-arrow-left\" size=\"small\" />\r\n      <span>Back to All Users</span>\r\n    </a>\r\n  </PageTitle>\r\n\r\n  <ViewScaffold {is_loading} {is_error} {error_message}>\r\n\r\n    {#if tracker.error}\r\n    <Notification type=\"danger\">\r\n      {error_message}\r\n    </Notification>\r\n    {/if}\r\n\r\n    {#if is_api_key}\r\n      <form on:submit=\"addNew(event)\">\r\n        <Panel title=\"API Key Details\">\r\n          <div class=\"columns\">\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Role</label>\r\n                  <span class=\"select is-fullwidth\">\r\n                    <select class=\"input\" required bind:value=\"data.role\">\r\n                      <option value=\"\">Select Role</option>\r\n                      {#each Object.entries(roles) as role}\r\n                      <option value=\"{role[0]}\">{role[1]}</option>\r\n                      {/each}\r\n                    </select>\r\n                  </span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Key Description</label>\r\n                  <input class=\"input\" type=\"text\" required bind:value=\"data.name\" />\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">&nbsp;</label>\r\n                  <SubmitButton classes=\"is-primary is-pulled-right\" icon=\"plus\" icon_size=\"small\" text=\"Create API Key\" bind:tracker />\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Panel>\r\n      </form>\r\n    {:else}\r\n      <form on:submit=\"addNew(event)\">\r\n        <Panel title=\"User Details\">\r\n          <div class=\"columns\">\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Role</label>\r\n                  <span class=\"select is-fullwidth\">\r\n                    <select class=\"input\" required bind:value=\"data.role\">\r\n                      <option value=\"\">Select Role</option>\r\n                      {#each Object.entries(roles) as role}\r\n                      <option value=\"{role[0]}\">{role[1]}</option>\r\n                      {/each}\r\n                    </select>\r\n                  </span>\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Name</label>\r\n                  <input class=\"input\" type=\"text\" required bind:value=\"data.name\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Surname</label>\r\n                  <input class=\"input \" type=\"text\" bind:value=\"data.surname\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Email</label>\r\n                  <input class=\"input\" type=\"email\" bind:value=\"data.email\" />\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Username</label>\r\n                  <input class=\"input\" type=\"text\" required bind:value=\"data.username\" autocomplete=\"off\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Password</label>\r\n                  <input class=\"input {data.password && !valid ? 'is-danger' : ''}\" type=\"password\" required bind:value=\"data.password\" autocomplete=\"off\" />\r\n                  <PasswordValidator new_pass={data.password} bind:valid />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Confirm Password</label>\r\n                  <input class=\"input {data.password != confirm_password ? 'is-danger' : ''}\" type=\"password\" required bind:value=\"confirm_password\"\r\n                  />\r\n                </p>\r\n              </div>\r\n              <!-- <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"checkbox\">\r\n                      <input class=\"checkbox\" type=\"checkbox\" bind:checked=\"data.should_change_password\" />\r\n                      Require this user to change their password on first login\r\n                  </label>\r\n                </p>\r\n              </div> -->\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">&nbsp;</label>\r\n                  <SubmitButton classes=\"is-primary is-pulled-right\" icon=\"plus\" icon_size=\"small\" text=\"Create User\" bind:tracker />\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Panel>\r\n      </form>\r\n    {/if}\r\n\r\n  </ViewScaffold>\r\n</div>\r\n\r\n<script>\r\n  import Model from '../../models/users';\r\n  import Router from '../../services/router';\r\n  import { Icon, Notification, Panel } from '@kws3/helpers';\r\n  import { SubmitButton } from '@kws3/buttons';\r\n  export default {\r\n    components: {\r\n      ViewScaffold: '../helpers/ViewScaffold.html',\r\n      PageTitle: '../helpers/PageTitle.html',\r\n      PasswordValidator:'../helpers/PasswordValidator.html',\r\n      Panel,\r\n      Icon,\r\n      Notification,\r\n      SubmitButton\r\n    },\r\n\r\n    data() {\r\n      return {\r\n        is_loading: false,\r\n        is_error: false,\r\n        error_message: '',\r\n        data: {\r\n          role: '',\r\n          name: '',\r\n          surname: '',\r\n          username: '',\r\n          email: '',\r\n          password: '',\r\n          // should_change_password:true\r\n        },\r\n        tracker: {\r\n          saving: false,\r\n          saved: false,\r\n          error: false,\r\n        },\r\n        confirm_password: '',\r\n        page: {\r\n          title: 'Add User',\r\n          icon: 'vcard-o',\r\n          icon_badge: 'plus'\r\n        },\r\n        roles: {},\r\n        valid:false\r\n      }\r\n    },\r\n    computed: {\r\n      user_role: ({ $user }) => $user && $user.role,\r\n      is_api_key: ({ data }) => ['AK'].indexOf(data.role) != -1\r\n    },\r\n    oncreate: function () {\r\n\r\n      this.loadRoles();\r\n    },\r\n    methods: {\r\n       loadRoles(){\r\n\r\n        this.set({\r\n          is_loading: true,\r\n          is_error: false\r\n        });\r\n\r\n        Model.authContext(this.get().user_role)\r\n        .then((r) => {\r\n          this.set({\r\n            is_loading: false,\r\n            roles: r.response\r\n          });\r\n        })\r\n        .catch((r) => {\r\n          var user_message = '';\r\n          if (typeof r.response != 'undefined' && typeof r.response.records != 'undefined'){\r\n            user_message = r.response.records.userMessage;\r\n          }\r\n          this.set({\r\n            is_error: true,\r\n            is_loading: false,\r\n            error_message: user_message\r\n          });\r\n        });\r\n      },\r\n      addNew(e) {\r\n        e.preventDefault();\r\n\r\n        var { data, confirm_password, valid }  = this.get();\r\n\r\n        if (data.password != confirm_password || !valid) return;\r\n\r\n        this.set({\r\n          tracker: {\r\n            saving: true,\r\n            saved: false,\r\n            error: false\r\n          }\r\n        });\r\n\r\n        Model.create(data)\r\n        .then( (r) => {\r\n          r.response.password = '';\r\n          this.set({\r\n            tracker: {\r\n              saving: false,\r\n              saved: true,\r\n              error: false\r\n            },\r\n            data: r.response,\r\n            confirm_password:''\r\n          });\r\n\r\n          setTimeout( () => {\r\n            this.set({ tracker: { saved: false } });\r\n            Router.navigate('users');\r\n          }, 1500);\r\n\r\n        })\r\n        .catch( (r) => {\r\n          if (r.response.records.errorCode == '406') {\r\n            this.set({error_message: r.response.records.userMessage});\r\n          }else{\r\n            this.set({error_message: 'There was an error adding user'});\r\n          }\r\n          this.set({\r\n            tracker: {\r\n              saving: false,\r\n              saved: false,\r\n              error: true\r\n            }\r\n          });\r\n\r\n          setTimeout( () => {\r\n            this.set({ tracker: { error: false } });\r\n          }, 3000);\r\n\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n</script>"],"names":["$user","role","data","indexOf","is_loading","is_error","error_message","name","surname","username","email","password","tracker","saving","saved","error","confirm_password","page","title","icon","icon_badge","roles","valid","[object Object]","this","set","Model","authContext","get","user_role","then","r","response","catch","user_message","records","userMessage","e","preventDefault","create","setTimeout","Router","navigate","errorCode","loadRoles","is_api_key","Object","entries","length","addNew","event"],"mappings":"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"}