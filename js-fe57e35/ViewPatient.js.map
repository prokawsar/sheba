{"version":3,"file":"ViewPatient.js","sources":["../../../src/components/views/patients/ViewPatient.html"],"sourcesContent":["<div class=\"page-content\">\r\n\r\n  <PageTitle page=\"{page}\">\r\n    <a class=\"button is-info is-inverted is-pulled-right\" href=\"#patients\">\r\n      <Icon icon=\"long-arrow-left\" size=\"small\" />\r\n      <span>Back to All Patients</span>\r\n    </a>\r\n  </PageTitle>\r\n\r\n  <ViewScaffold {is_loading} {is_error} {error_message}>\r\n\r\n    {#if tracker.error}\r\n      <Notification type=\"danger\">{error_message}</Notification>\r\n    {/if}\r\n\r\n    {#if !is_loading}\r\n      <form on:submit=\"fire('save', event)\">\r\n        <Panel title=\"Patient Details\">\r\n          <div class=\"columns\">\r\n            <div class=\"column\">\r\n\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Name</label>\r\n                  <input class=\"input\" type=\"text\" required bind:value=\"data.name\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Phone</label>\r\n                  <input class=\"input\" type=\"text\" bind:value=\"data.phone\" />\r\n                </p>\r\n              </div>\r\n\r\n              <div class=\"field\">\r\n                <div class=\"control\">\r\n\r\n                  <label class=\"label\">Gender</label>\r\n                  <label class=\"radio\">\r\n                    <input type=\"radio\" bind:group=\"data.gender\" value=\"m\"> Male\r\n                  </label>\r\n                  <label class=\"radio\">\r\n                    <input type=\"radio\" bind:group=\"data.gender\" value=\"f\"> Female\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n            <div class=\"column\">\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Age</label>\r\n                  <input class=\"input\" type=\"number\" required bind:value=\"data.age\" autocomplete=\"off\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">Address</label>\r\n                  <input class=\"input\" type=\"text\" bind:value=\"data.address\" autocomplete=\"off\" />\r\n                </p>\r\n              </div>\r\n              <div class=\"field\">\r\n                <p class=\"control\">\r\n                  <label class=\"label\">&nbsp;</label>\r\n                  <SubmitButton classes=\"is-primary is-pulled-right\" icon=\"plus\" icon_size=\"small\" text=\"Update Patient\" bind:tracker />\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Panel>\r\n      </form>\r\n    {/if}\r\n\r\n  </ViewScaffold>\r\n</div>\r\n\r\n<script>\r\n  import Model from '../../../models/patients';\r\n  import {Icon, Notification, Panel, Message} from '@kws3/helpers';\r\n  import { SubmitButton } from '@kws3/buttons';\r\n\r\n  export default {\r\n    components: {\r\n      ViewScaffold: '../../helpers/ViewScaffold.html',\r\n      PageTitle: '../../helpers/PageTitle.html',\r\n      Notification, SubmitButton,\r\n      Icon, Panel,\r\n\r\n    },\r\n    data() {\r\n      return {\r\n        is_loading: true,\r\n        is_error: false,\r\n        error_message: '',\r\n        data: {},\r\n        meta: {},\r\n        tracker: {\r\n          saving: false,\r\n          saved: false,\r\n          error: false,\r\n        },\r\n        page: {\r\n          title: 'View Patient',\r\n          subtitle: 'Modify Patient details',\r\n          icon: 'building-o',\r\n          icon_badge: 'pencil'\r\n        },\r\n      }\r\n    },\r\n    computed: {\r\n      entityId: ({ $nav }) => $nav && $nav.params[0]\r\n    },\r\n    oncreate() {\r\n      var { entityId } = this.get();\r\n\r\n      this.on('state', ({ changed, current, previous }) => {\r\n        if (changed['$nav']) {\r\n          var { $nav } = current;\r\n          if ($nav.activeView == '_COMPONENT_') {\r\n            this.load();\r\n          }\r\n        }\r\n      });\r\n\r\n      this.on('save', (e) => {\r\n        e.preventDefault();\r\n        var {data} = this.get();\r\n\r\n        if(data.name == '') return;\r\n\r\n        this.set({data});\r\n\r\n        this.save();\r\n      });\r\n\r\n      this.load();\r\n    },\r\n    methods: {\r\n      load() {\r\n        var { entityId } = this.get();\r\n\r\n        this.set({\r\n          'is_loading': true,\r\n          'is_error': false\r\n        });\r\n\r\n        Model.getOne(entityId)\r\n        .then((r) => {\r\n\r\n          this.set({\r\n            'is_loading': false,\r\n            'meta': r._meta,\r\n            'data': r.response\r\n          });\r\n\r\n        })\r\n        .catch((r) => {\r\n          var user_message = '';\r\n          if (typeof r != 'undefined' && typeof r.response != 'undefined' && typeof r.response.records != 'undefined') {\r\n            user_message = r.response.records.userMessage;\r\n          }\r\n          this.set({\r\n            'is_error': true,\r\n            'is_loading': false,\r\n            'error_message': user_message\r\n          });\r\n        });\r\n      },\r\n      save() {\r\n        var {data, entityId, tracker} = this.get();\r\n\r\n        this.set({\r\n          tracker: {\r\n            saving: true,\r\n            saved: false,\r\n            error: false\r\n          }\r\n        });\r\n\r\n        Model.save(entityId, data)\r\n        .then(r => {\r\n          this.set({\r\n            data: r.response,\r\n            tracker: {\r\n              saving: false,\r\n              saved: true,\r\n              error: false\r\n            }\r\n          });\r\n\r\n          setTimeout(() => {\r\n            tracker.saved = false;\r\n            this.set({tracker});\r\n          }, 1500);\r\n        })\r\n        .catch(r => {\r\n\r\n          if(r.response.records.errorCode == '406') {\r\n            this.set({error_message: 'The username you entered already exists, Please try another one'});\r\n          } else {\r\n            this.set({error_message: 'There was an error updating premise'});\r\n          }\r\n\r\n          this.set({\r\n            tracker: {\r\n              saving: false,\r\n              saved: false,\r\n              error: true\r\n            }\r\n          });\r\n\r\n          setTimeout(() => {\r\n            this.set({tracker: {error: false}});\r\n          }, 1500);\r\n        });\r\n      }\r\n    }\r\n  }\r\n</script>"],"names":["$nav","params","is_loading","is_error","error_message","data","meta","tracker","saving","saved","error","page","title","subtitle","icon","icon_badge","[object Object]","entityId","this","get","set","Model","getOne","then","r","_meta","response","catch","user_message","records","userMessage","save","setTimeout","errorCode","on","changed","current","previous","activeView","load","e","preventDefault","name","phone","gender","age","address","fire","event"],"mappings":"+iBAiFA,mBA6BiBA,KAAEA,WAAWA,GAAQA,EAAKC,OAAO,mBApB5C,MAAO,CACLC,YAAY,EACZC,UAAU,EACVC,cAAe,GACfC,KAAM,GACNC,KAAM,GACNC,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,GAETC,KAAM,CACJC,MAAO,eACPC,SAAU,yBACVC,KAAM,aACNC,WAAY,uBAgCT,CACPC,OACE,IAAIC,SAAEA,GAAaC,KAAKC,MAExBD,KAAKE,IAAI,CACPlB,YAAc,EACdC,UAAY,IAGdkB,MAAMC,OAAOL,GACZM,KAAMC,IAELN,KAAKE,IAAI,CACPlB,YAAc,EACdI,KAAQkB,EAAEC,MACVpB,KAAQmB,EAAEE,aAIbC,MAAOH,IACN,IAAII,EAAe,QACH,IAALJ,QAAyC,IAAdA,EAAEE,eAAwD,IAAtBF,EAAEE,SAASG,UACnFD,EAAeJ,EAAEE,SAASG,QAAQC,aAEpCZ,KAAKE,IAAI,CACPjB,UAAY,EACZD,YAAc,EACdE,cAAiBwB,OAIvBZ,OACE,IAAIX,KAACA,EAAIY,SAAEA,EAAQV,QAAEA,GAAWW,KAAKC,MAErCD,KAAKE,IAAI,CACPb,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,KAIXW,MAAMU,KAAKd,EAAUZ,GACpBkB,KAAKC,IACJN,KAAKE,IAAI,CACPf,KAAMmB,EAAEE,SACRnB,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,KAIXsB,WAAW,KACTzB,EAAQE,OAAQ,EAChBS,KAAKE,IAAI,CAACb,QAAAA,KACT,QAEJoB,MAAMH,IAE8B,OAAhCA,EAAEE,SAASG,QAAQI,UACpBf,KAAKE,IAAI,CAAChB,cAAe,oEAEzBc,KAAKE,IAAI,CAAChB,cAAe,wCAG3Bc,KAAKE,IAAI,CACPb,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,KAIXsB,WAAW,KACTd,KAAKE,IAAI,CAACb,QAAS,CAACG,OAAO,MAC1B,8BApGP,IAAIO,SAAEA,GAAaC,KAAKC,MAExBD,KAAKgB,GAAG,QAAS,EAAGC,QAAAA,EAASC,QAAAA,EAASC,SAAAA,MACpC,GAAIF,EAAc,KAAG,CACnB,IAAInC,KAAEA,GAASoC,EACQ,eAAnBpC,EAAKsC,YACPpB,KAAKqB,UAKXrB,KAAKgB,GAAG,OAASM,IACfA,EAAEC,iBACF,IAAIpC,KAACA,GAAQa,KAAKC,MAEF,IAAbd,EAAKqC,OAERxB,KAAKE,IAAI,CAACf,KAAAA,IAEVa,KAAKa,UAGPb,KAAKqB,yJArIS5B,+FASXJ,QAAa,mCAIZL,iDANOA,sBAAaC,yBAAWC,gxBAPrBO,kBASXJ,QAAQG,2FAIPR,mIANOA,sCAAaC,8CAAWC,8QAGNA,uHAAAA,2MAYqCC,KAAKqC,2DAMdrC,KAAKsC,uDAShBtC,KAAKuC,sDAGLvC,KAAKuC,2DAUiBvC,KAAKwC,qEAMhBxC,KAAKyC,uJAM0DvC,uBAAAA,mWAhDvGwC,KAAK,OAAQC,mkFAQoC3C,KAAKqC,uFAMdrC,KAAKsC,kHAShBtC,KAAKuC,+EAGLvC,KAAKuC,iHAUiBvC,KAAKwC,sFAMhBxC,KAAKyC,2IAlCIzC,KAAKqC,6BAMdrC,KAAKsC,wCAShBtC,KAAKuC,yCAGLvC,KAAKuC,+BAUiBvC,KAAKwC,4BAMhBxC,KAAKyC,sDAM0DvC,6BAAAA"}