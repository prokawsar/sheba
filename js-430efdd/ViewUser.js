var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{w as addListener,a as append,b as assign,c as assignTrue,z as createComment,d as createElement,e as createFragment,f as createText,A as destroyEach,g as detachNode,h as flush,i as init,j as insert,l as proto,m as removeFromStore,x as removeListener,X as selectOption,Y as selectValue,y as setAttribute,B as setData,C as setStyle,n as Icon,E as Notification,D as Panel,q as ViewScaffold,r as PageTitle}from"./chunk-ce2fee6f.js";import{a as Router}from"./chunk-0860a2de.js";import{c as DeleteButton,b as SubmitButton}from"./chunk-d9e89df1.js";import{a as PasswordValidator}from"./chunk-efa5da2d.js";import{a as FileUpload}from"./chunk-d3be2f99.js";import{a as Model}from"./chunk-c6f1a385.js";function entityId({$nav:e}){return e&&e.params[0]}function user_role({$user:e}){return e&&e.role}function is_api_key({data:e}){return-1!=["AK"].indexOf(e.role)}function data(){return{is_loading:!0,is_error:!1,error_message:"",data:{role:"",name:"",surname:"",email:"",password:""},meta:{},tracker:{saving:!1,saved:!1,error:!1},new_pass:"",confirm_pass:"",page:{title:"View User",subtitle:"Change user details",icon:"vcard-o",icon_badge:"pencil"},password_tracker:"",roles:{},valid:!1}}var methods={load(){var e=this.get().entityId;this.set({is_loading:!0,is_error:!1}),Model&&Model.getOne(e,this.get().user_role).then(e=>{this.set({is_loading:!1,meta:e[1]._meta,roles:e[0].response,data:e[1].response})}).catch(e=>{var t="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(t=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:t})})},updatePassword(e){e.preventDefault();var{new_pass:t,confirm_pass:a,entityId:r,valid:s}=this.get();""!=t&&t===a&&s&&(this.set({password_tracker:{saving:!0,saved:!1,error:!1}}),Model.save(r,{password:t}).then(e=>{this.set({password_tracker:{saving:!1,saved:!0,error:!1},new_pass:"",confirm_pass:""}),setTimeout(()=>{this.set({password_tracker:{saved:!1}})},3e3)}).catch(e=>{this.set({password_tracker:{saving:!1,saved:!1,error:!0}}),setTimeout(()=>{this.set({password_tracker:{error:!1}})},3e3)}))},save(e){e.preventDefault();var{data:t,entityId:a}=this.get();this.set({tracker:{saving:!0,saved:!1,error:!1}}),Model.save(a,t).then(e=>{this.set({data:e.response}),this.set({tracker:{saving:!1,saved:!0,error:!1}}),setTimeout(()=>{this.set({tracker:{saved:!1}})},3e3)}).catch(e=>{"406"==e.response.records.errorCode?this.set({error_message:" The username you entered already exists, Please try another one"}):this.set({error_message:"There was an error adding user"}),this.set({tracker:{saving:!1,saved:!1,error:!0}}),setTimeout(()=>{this.set({tracker:{error:!1}})},3e3)})}};function oncreate(){this.on("erase",e=>{e.doing(),Model.delete(this.get().entityId).then(t=>{e.done()}).catch(()=>{e.error()})}),this.on("erased",e=>{Router.navigate("users")}),this.on("file_chosen",e=>{var t=e.getFile();t.size;e.progress(0),Model.uploadAvatar(this.get().entityId,t.file,t=>{e.progress(t.loaded)}).then(t=>{this.set({data:t.response}),e.uploaded()}).catch(t=>{var a="Failed to upload!";void 0!==t&&void 0!==t.response&&void 0!==t.response.records&&(a=t.response.records.userMessage),e.error(a)})}),this.load()}function onstate({changed:e,current:t,previous:a}){if(e.$nav){var{$nav:r}=t;"ViewUser"==r.activeView&&this.load()}}function get_each_context(e,t,a){const r=Object.create(e);return r.role=t[a],r}function create_main_fragment(e,t){var a,r,s,n,o,d,l,i=new Icon({root:e.root,store:e.store,data:{icon:"long-arrow-left",size:"small"}}),c={page:t.page},p=new PageTitle({root:e.root,store:e.store,slots:{default:createFragment()},data:c}),m=t.tracker.error&&create_if_block_2(e,t);function u(e){return e.is_api_key?create_if_block:create_else_block}var _=u(t),v=_(e,t),f={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message},g=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:f});return{c(){a=createElement("div"),r=createElement("a"),i._fragment.c(),s=createText("\r\n      "),(n=createElement("span")).textContent="Back to All Users",p._fragment.c(),o=createText("\r\n\r\n  "),m&&m.c(),d=createText("\r\n\r\n    "),v.c(),l=createComment(),g._fragment.c(),r.className="button is-info is-pulled-right",r.href="#users",a.className="page-content"},m(e,t){insert(e,a,t),append(p._slotted.default,r),i._mount(r,null),append(r,s),append(r,n),p._mount(a,null),append(a,o),m&&m.m(g._slotted.default,null),append(g._slotted.default,d),v.m(g._slotted.default,null),append(g._slotted.default,l),g._mount(a,null)},p(t,a){var r={};t.page&&(r.page=a.page),p._set(r),a.tracker.error?m?m.p(t,a):((m=create_if_block_2(e,a)).c(),m.m(d.parentNode,d)):m&&(m.d(1),m=null),_===(_=u(a))&&v?v.p(t,a):(v.d(1),(v=_(e,a)).c(),v.m(l.parentNode,l));var s={};t.is_loading&&(s.is_loading=a.is_loading),t.is_error&&(s.is_error=a.is_error),t.error_message&&(s.error_message=a.error_message),g._set(s)},d(e){e&&detachNode(a),i.destroy(),p.destroy(),m&&m.d(),v.d(),g.destroy()}}}function create_if_block_2(e,t){var a,r=new Notification({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger"}});return{c(){a=createText(t.error_message),r._fragment.c()},m(e,t){append(r._slotted.default,a),r._mount(e,t)},p(e,t){e.error_message&&setData(a,t.error_message)},d(e){r.destroy(e)}}}function create_else_block(e,t){var a,r,s,n,o,d,l,i,c,p,m,u,_,v,f,g,h,b,E,w,k,x,N,y,T,j,O,L,P,C,D,V,A,U,F,I,S,K,M,B,$,R,z,q,X,Y,G,H,J,Q,W,Z,ee,te,ae,re,se,ne,oe,de,le,ie,ce,pe,me,ue,_e,ve,fe,ge,he=!1,be=!1,Ee=!1,we=!1,ke=!1,xe={},Ne=!1,ye={},Te=!1,je={},Oe=new DeleteButton({root:e.root,store:e.store,data:{text:"Delete User"}});Oe.on("erase",function(t){e.fire("erase",t)}),Oe.on("erased",function(t){e.fire("erased",t)});for(var Le=t.Object.entries(t.roles),Pe=[],Ce=0;Ce<Le.length;Ce+=1)Pe[Ce]=create_each_block(e,get_each_context(t,Le,Ce));function De(){he=!0,t.data.role=selectValue(_),e.set({data:t.data,Object:t.Object,roles:t.roles}),he=!1}function Ve(){be=!0,t.data.username=k.value,e.set({data:t.data,Object:t.Object,roles:t.roles}),be=!1}function Ae(){Ee=!0,t.data.email=O.value,e.set({data:t.data,Object:t.Object,roles:t.roles}),Ee=!1}function Ue(){we=!0,t.data.name=U.value,e.set({data:t.data,Object:t.Object,roles:t.roles}),we=!1}function Fe(){ke=!0,t.data.surname=B.value,e.set({data:t.data,Object:t.Object,roles:t.roles}),ke=!1}var Ie={classes:"is-primary is-pulled-right"};void 0!==t.tracker&&(Ie.tracker=t.tracker,xe.tracker=!0);var Se=new SubmitButton({root:e.root,store:e.store,data:Ie,_bind(t,a){var r={};!xe.tracker&&t.tracker&&(r.tracker=a.tracker),e._set(r),xe={}}});e.root._beforecreate.push(()=>{Se._bind({tracker:1},Se.get())});var Ke=new Panel({root:e.root,store:e.store,slots:{default:createFragment(),toolbar:createFragment()},data:{title:"Update Details"}});function Me(t){e.save(t)}var Be=t.data&&t.data.avatarurl&&create_if_block_1(e,t),$e=new FileUpload({root:e.root,store:e.store,data:{max:"1048579",allowed:["png","jpg","jpeg"],message:"Upload new avatar..."}});$e.on("file_chosen",function(t){e.fire("file_chosen",t)});var Re=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Update Avatar"}});function ze(){Ne=!0,e.set({new_pass:ne.value}),Ne=!1}var qe={new_pass:t.new_pass};void 0!==t.valid&&(qe.valid=t.valid,ye.valid=!0);var Xe=new PasswordValidator({root:e.root,store:e.store,data:qe,_bind(t,a){var r={};!ye.valid&&t.valid&&(r.valid=a.valid),e._set(r),ye={}}});function Ye(){Te=!0,e.set({confirm_pass:ue.value}),Te=!1}e.root._beforecreate.push(()=>{Xe._bind({valid:1},Xe.get())});var Ge={icon_size:"small",classes:"is-primary is-pulled-right",text:"Update Password"};void 0!==t.password_tracker&&(Ge.tracker=t.password_tracker,je.tracker=!0);var He=new SubmitButton({root:e.root,store:e.store,data:Ge,_bind(t,a){var r={};!je.tracker&&t.tracker&&(r.password_tracker=a.tracker),e._set(r),je={}}});e.root._beforecreate.push(()=>{He._bind({tracker:1},He.get())});var Je=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Update Password"}});function Qe(t){e.updatePassword(t)}return{c(){a=createElement("div"),r=createElement("div"),s=createElement("form"),n=createElement("div"),Oe._fragment.c(),o=createText("\r\n              "),d=createElement("div"),l=createElement("div"),i=createElement("div"),c=createElement("p"),(p=createElement("label")).textContent="Role",m=createText("\r\n                      "),u=createElement("span"),_=createElement("select"),(v=createElement("option")).textContent="Select Role";for(var he=0;he<Pe.length;he+=1)Pe[he].c();g=createText("\r\n                  "),h=createElement("div"),b=createElement("p"),(E=createElement("label")).textContent="Username",w=createText("\r\n                      "),k=createElement("input"),x=createText("\r\n                  "),N=createElement("div"),y=createElement("p"),(T=createElement("label")).textContent="Email",j=createText("\r\n                      "),O=createElement("input"),L=createText("\r\n                "),P=createElement("div"),C=createElement("div"),D=createElement("p"),(V=createElement("label")).textContent="Name",A=createText("\r\n                      "),U=createElement("input"),F=createText("\r\n                  "),I=createElement("div"),S=createElement("p"),(K=createElement("label")).textContent="Surname",M=createText("\r\n                      "),B=createElement("input"),$=createText("\r\n                  "),R=createElement("div"),z=createElement("p"),(q=createElement("label")).textContent="Â ",X=createText("\r\n                      "),Se._fragment.c(),Ke._fragment.c(),Y=createText("\r\n\r\n        "),G=createElement("div"),H=createElement("div"),J=createElement("div"),Q=createElement("figure"),Be&&Be.c(),W=createText("\r\n              "),$e._fragment.c(),Re._fragment.c(),Z=createText("\r\n          "),ee=createElement("form"),te=createElement("div"),ae=createElement("p"),(re=createElement("label")).textContent="New Password",se=createText("\r\n                  "),ne=createElement("input"),de=createText("\r\n                  "),Xe._fragment.c(),le=createText("\r\n              "),ie=createElement("div"),ce=createElement("p"),(pe=createElement("label")).textContent="Confirm Password",me=createText("\r\n                  "),ue=createElement("input"),ve=createText("\r\n              "),fe=createElement("div"),ge=createElement("p"),He._fragment.c(),Je._fragment.c(),setAttribute(n,"slot","toolbar"),p.className="label",v.__value="",v.value=v.__value,addListener(_,"change",De),"data"in t||e.root._beforecreate.push(De),_.className=f="input "+(""==t.data.role?"is-danger":""),_.disabled=t.disabled,u.className="select is-fullwidth",c.className="control",i.className="field",E.className="label",addListener(k,"input",Ve),k.className="input",setAttribute(k,"type","text"),k.required=!0,k.disabled=t.disabled,b.className="control",h.className="field",T.className="label",addListener(O,"input",Ae),O.className="input",setAttribute(O,"type","email"),y.className="control",N.className="field",l.className="column is-6",V.className="label",addListener(U,"input",Ue),U.className="input",setAttribute(U,"type","text"),U.required=!0,U.disabled=t.disabled,D.className="control",C.className="field",K.className="label",addListener(B,"input",Fe),B.className="input ",setAttribute(B,"type","text"),S.className="control",I.className="field",q.className="label",z.className="control",R.className="field",P.className="column is-6",d.className="columns is-multiline",addListener(s,"submit",Me),r.className="column is-7",Q.className="image is-128x128",setStyle(Q,"margin","0 auto 20px auto"),J.className="is-text-centered",re.className="label",addListener(ne,"input",ze),ne.className=oe="input "+(t.new_pass&&!t.valid?"is-danger":""),setAttribute(ne,"type","password"),ae.className="control",te.className="field",pe.className="label",addListener(ue,"input",Ye),ue.className=_e="input "+(t.new_pass!=t.confirm_pass?"is-danger":""),setAttribute(ue,"type","password"),ce.className="control",ie.className="field",ge.className="control",fe.className="field",addListener(ee,"submit",Qe),G.className="column",a.className="columns"},m(e,f){insert(e,a,f),append(a,r),append(r,s),append(Ke._slotted.toolbar,n),Oe._mount(n,null),append(Ke._slotted.default,o),append(Ke._slotted.default,d),append(d,l),append(l,i),append(i,c),append(c,p),append(c,m),append(c,u),append(u,_),append(_,v);for(var oe=0;oe<Pe.length;oe+=1)Pe[oe].m(_,null);selectOption(_,t.data.role),append(l,g),append(l,h),append(h,b),append(b,E),append(b,w),append(b,k),k.value=t.data.username,append(l,x),append(l,N),append(N,y),append(y,T),append(y,j),append(y,O),O.value=t.data.email,append(d,L),append(d,P),append(P,C),append(C,D),append(D,V),append(D,A),append(D,U),U.value=t.data.name,append(P,F),append(P,I),append(I,S),append(S,K),append(S,M),append(S,B),B.value=t.data.surname,append(P,$),append(P,R),append(R,z),append(z,q),append(z,X),Se._mount(z,null),Ke._mount(s,null),append(a,Y),append(a,G),append(Re._slotted.default,H),append(H,J),append(J,Q),Be&&Be.m(Q,null),append(H,W),$e._mount(H,null),Re._mount(G,null),append(G,Z),append(G,ee),append(Je._slotted.default,te),append(te,ae),append(ae,re),append(ae,se),append(ae,ne),ne.value=t.new_pass,append(ae,de),Xe._mount(ae,null),append(Je._slotted.default,le),append(Je._slotted.default,ie),append(ie,ce),append(ce,pe),append(ce,me),append(ce,ue),ue.value=t.confirm_pass,append(Je._slotted.default,ve),append(Je._slotted.default,fe),append(fe,ge),He._mount(ge,null),Je._mount(ee,null)},p(a,r){if(t=r,a.Object||a.roles){Le=t.Object.entries(t.roles);for(var s=0;s<Le.length;s+=1){const r=get_each_context(t,Le,s);Pe[s]?Pe[s].p(a,r):(Pe[s]=create_each_block(e,r),Pe[s].c(),Pe[s].m(_,null))}for(;s<Pe.length;s+=1)Pe[s].d(1);Pe.length=Le.length}!he&&a.data&&selectOption(_,t.data.role),a.data&&f!==(f="input "+(""==t.data.role?"is-danger":""))&&(_.className=f),a.disabled&&(_.disabled=t.disabled),!be&&a.data&&(k.value=t.data.username),a.disabled&&(k.disabled=t.disabled),!Ee&&a.data&&(O.value=t.data.email),!we&&a.data&&(U.value=t.data.name),a.disabled&&(U.disabled=t.disabled),!ke&&a.data&&(B.value=t.data.surname);var n={};!xe.tracker&&a.tracker&&(n.tracker=t.tracker,xe.tracker=void 0!==t.tracker),Se._set(n),xe={},t.data&&t.data.avatarurl?Be?Be.p(a,t):((Be=create_if_block_1(e,t)).c(),Be.m(Q,null)):Be&&(Be.d(1),Be=null),!Ne&&a.new_pass&&(ne.value=t.new_pass),(a.new_pass||a.valid)&&oe!==(oe="input "+(t.new_pass&&!t.valid?"is-danger":""))&&(ne.className=oe);var o={};a.new_pass&&(o.new_pass=t.new_pass),!ye.valid&&a.valid&&(o.valid=t.valid,ye.valid=void 0!==t.valid),Xe._set(o),ye={},!Te&&a.confirm_pass&&(ue.value=t.confirm_pass),(a.new_pass||a.confirm_pass)&&_e!==(_e="input "+(t.new_pass!=t.confirm_pass?"is-danger":""))&&(ue.className=_e);var d={};!je.tracker&&a.password_tracker&&(d.tracker=t.password_tracker,je.tracker=void 0!==t.password_tracker),He._set(d),je={}},d(e){e&&detachNode(a),Oe.destroy(),destroyEach(Pe,e),removeListener(_,"change",De),removeListener(k,"input",Ve),removeListener(O,"input",Ae),removeListener(U,"input",Ue),removeListener(B,"input",Fe),Se.destroy(),Ke.destroy(),removeListener(s,"submit",Me),Be&&Be.d(),$e.destroy(),Re.destroy(),removeListener(ne,"input",ze),Xe.destroy(),removeListener(ue,"input",Ye),He.destroy(),Je.destroy(),removeListener(ee,"submit",Qe)}}}function create_if_block(e,t){var a,r,s,n,o,d,l,i,c,p,m,u,_,v,f,g,h,b,E,w,k=t.roles[t.data.role],x=t.data.username,N=t.data.name,y=new DeleteButton({root:e.root,store:e.store,data:{text:"Delete API Key"}});y.on("erase",function(t){e.fire("erase",t)}),y.on("erased",function(t){e.fire("erased",t)});var T=new Panel({root:e.root,store:e.store,slots:{default:createFragment(),toolbar:createFragment()},data:{title:"API Key Details"}});return{c(){a=createElement("div"),y._fragment.c(),r=createText("\r\n\r\n        "),s=createElement("table"),n=createElement("tr"),(o=createElement("th")).textContent="Key type",d=createText("\r\n            "),l=createElement("td"),i=createText(k),c=createText("\r\n          "),p=createElement("tr"),(m=createElement("th")).textContent="API Key",u=createText("\r\n            "),_=createElement("td"),v=createText(x),f=createText("\r\n          "),g=createElement("tr"),(h=createElement("th")).textContent="Description",b=createText("\r\n            "),E=createElement("td"),w=createText(N),T._fragment.c(),setAttribute(a,"slot","toolbar"),s.className="table"},m(e,t){append(T._slotted.toolbar,a),y._mount(a,null),append(T._slotted.default,r),append(T._slotted.default,s),append(s,n),append(n,o),append(n,d),append(n,l),append(l,i),append(s,c),append(s,p),append(p,m),append(p,u),append(p,_),append(_,v),append(s,f),append(s,g),append(g,h),append(g,b),append(g,E),append(E,w),T._mount(e,t)},p(e,t){(e.roles||e.data)&&k!==(k=t.roles[t.data.role])&&setData(i,k),e.data&&x!==(x=t.data.username)&&setData(v,x),e.data&&N!==(N=t.data.name)&&setData(w,N)},d(e){y.destroy(),T.destroy(e)}}}function create_each_block(e,t){var a,r,s,n=t.role[1];return{c(){a=createElement("option"),r=createText(n),a.__value=s=t.role[0],a.value=a.__value},m(e,t){insert(e,a,t),append(a,r)},p(e,t){(e.Object||e.roles)&&n!==(n=t.role[1])&&setData(r,n),(e.Object||e.roles)&&s!==(s=t.role[0])&&(a.__value=s),a.value=a.__value},d(e){e&&detachNode(a)}}}function create_if_block_1(e,t){var a,r;return{c(){(a=createElement("img")).src=r=t.data.avatarurl,a.alt=""},m(e,t){insert(e,a,t)},p(e,t){e.data&&r!==(r=t.data.avatarurl)&&(a.src=r)},d(e){e&&detachNode(a)}}}function ViewUser(e){init(this,e),this._state=assign(assign(assign({Object:Object},this.store._init(["nav","user"])),data()),e.data),this.store._add(this,["nav","user"]),this._recompute({$nav:1,$user:1,data:1},this._state),this._intro=!0,this._handlers.state=[onstate],this._handlers.destroy=[removeFromStore],onstate.call(this,{changed:assignTrue({},this._state),current:this._state}),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}assign(ViewUser.prototype,proto),assign(ViewUser.prototype,methods),ViewUser.prototype._recompute=function(e,t){e.$nav&&this._differs(t.entityId,t.entityId=entityId(t))&&(e.entityId=!0),e.$user&&this._differs(t.user_role,t.user_role=user_role(t))&&(e.user_role=!0),e.data&&this._differs(t.is_api_key,t.is_api_key=is_api_key(t))&&(e.is_api_key=!0)};export default ViewUser;
//# sourceMappingURL=ViewUser.js.map
