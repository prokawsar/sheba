var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{s as baseModel,t as Net,w as addListener,a as append,b as assign,c as assignTrue,d as createElement,e as createFragment,f as createText,g as detachNode,h as flush,i as init,j as insert,l as proto,m as removeFromStore,x as removeListener,y as setAttribute,B as setData,C as setStyle,n as Icon,E as Notification,D as Panel,o as Message,q as ViewScaffold,r as PageTitle}from"./chunk-ce2fee6f.js";import{b as SubmitButton}from"./chunk-d9e89df1.js";import{a as PasswordValidator}from"./chunk-efa5da2d.js";import{a as FileUpload}from"./chunk-d3be2f99.js";var Model=new class extends baseModel{constructor(){super(),this.apiEndpoint="/profile",this.oldGetOne=this.getOne,this.getOne=(e=>Net.get(e||this.apiEndpoint)),this.oldSave=this.save,this.save=((e,a)=>this.oldSave("",e,a))}uploadAvatar(e,a){return this.upload("avatar",e,a)}};function should_change_password({$user:e}){return!!e.should_change_password}function data(){return{is_loading:!0,is_error:!1,error_message:"",data:{},meta:{},page:{title:"My Profile",subtitle:"Update my details",icon:"user-circle-o"},tracker:{saving:!1,saved:!1,error:!1},password_tracker:{saving:!1,saved:!1,error:!1},new_pass:"",confirm_pass:"",valid:!1}}var methods={load(){this.set({is_loading:!0,is_error:!1}),Model.getOne().then(e=>{this.set({is_loading:!1,meta:e._meta,data:e.response})}).catch(e=>{var a="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(a=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:a})})},updatePassword(e){e.preventDefault();var{new_pass:a,confirm_pass:t,valid:s}=this.get();""!=a&&a===t&&s&&(this.set({password_tracker:{saving:!0,saved:!1,error:!1}}),Model.save({password:a}).then(e=>{this.fire("updateLoggedIn",{name:e.response.name,surname:e.response.surname,username:e.response.username,email:e.response.email,avatar:e.response.avatarurl,should_change_password:e.response.should_change_password}),this.set({password_tracker:{saving:!1,saved:!0,error:!1},new_pass:"",confirm_pass:""}),setTimeout(()=>{this.set({password_tracker:{saved:!1}})},3e3)}).catch(e=>{this.set({password_tracker:{saving:!1,saved:!1,error:!0}}),setTimeout(()=>{this.set({password_tracker:{error:!1}})},3e3)}))},save(e){e.preventDefault();var{data:a}=this.get();""!=a.name&&""!=a.username&&(this.set({tracker:{saving:!0,saved:!1,error:!1}}),Model.save(a).then(e=>{this.set({data:e.response}),this.set({tracker:{saving:!1,saved:!0,error:!1}}),this.fire("updateLoggedIn",{name:e.response.name,surname:e.response.surname,username:e.response.username,email:e.response.email,avatar:e.response.avatarurl,should_change_password:e.response.should_change_password}),setTimeout(()=>{this.set({tracker:{saved:!1}})},3e3)}).catch(e=>{"406"==e.response.records.errorCode?this.set({error_message:" The username you entered already exists, Please try another one"}):this.set({error_message:"There was an error updating profile"}),this.set({tracker:{saving:!1,saved:!1,error:!0}}),setTimeout(()=>{this.set({tracker:{error:!1}})},3e3)}))}};function oncreate(){this.on("file_chosen",e=>{var a=e.getFile();a.size;e.progress(0),Model.uploadAvatar(a.file,a=>{e.progress(a.loaded)}).then(a=>{this.set({data:a.response}),this.fire("updateLoggedIn",{name:a.response.name,surname:a.response.surname,username:a.response.username,email:a.response.email,avatar:a.response.avatarurl,should_change_password:a.response.should_change_password}),e.uploaded()}).catch(a=>{var t="Failed to upload!";void 0!==a&&void 0!==a.response&&void 0!==a.response.records&&(t=a.response.records.userMessage),e.error(t)})}),this.load()}function onstate({changed:e,current:a,previous:t}){if(e.$nav){var{$nav:s}=a;"Profile"==s.activeView&&this.load()}}function create_main_fragment(e,a){var t,s,r,n,o,d,l,i,p,c,u,m,_,v,f,g,h,w,b,k,N,E,x,y,T,P,L,F,S,C,M,A,V,D,U,j,B,I,O,$,z,K,q,G,R,Y,H,J,Q,W,X,Z,ee,ae,te,se,re,ne,oe,de,le,ie,pe,ce,ue=!1,me=!1,_e=!1,ve=!1,fe={},ge=!1,he={},we=!1,be={},ke=new Icon({root:e.root,store:e.store,data:{icon:"long-arrow-left",size:"small"}}),Ne={page:a.page},Ee=new PageTitle({root:e.root,store:e.store,slots:{default:createFragment()},data:Ne}),xe=a.tracker.error&&create_if_block_2(e,a),ye=a.should_change_password&&create_if_block_1(e,a);function Te(){ue=!0,a.data.username=f.value,e.set({data:a.data}),ue=!1}function Pe(){me=!0,a.data.email=E.value,e.set({data:a.data}),me=!1}function Le(){_e=!0,a.data.name=S.value,e.set({data:a.data}),_e=!1}function Fe(){ve=!0,a.data.surname=j.value,e.set({data:a.data}),ve=!1}var Se={icon_size:"small",classes:"is-primary is-pulled-right",cy:"save-profile-button"};void 0!==a.tracker&&(Se.tracker=a.tracker,fe.tracker=!0);var Ce=new SubmitButton({root:e.root,store:e.store,data:Se,_bind(a,t){var s={};!fe.tracker&&a.tracker&&(s.tracker=t.tracker),e._set(s),fe={}}});e.root._beforecreate.push(()=>{Ce._bind({tracker:1},Ce.get())});var Me=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Update Details"}});function Ae(a){e.save(a)}var Ve=a.data&&a.data.avatarurl&&create_if_block(e,a),De=new FileUpload({root:e.root,store:e.store,data:{max:"1048579",allowed:["png","jpg","jpeg"],message:"Upload new avatar..."}});De.on("file_chosen",function(a){e.fire("file_chosen",a)});var Ue=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Update Avatar"}});function je(){ge=!0,e.set({new_pass:Z.value}),ge=!1}var Be={new_pass:a.new_pass};void 0!==a.valid&&(Be.valid=a.valid,he.valid=!0);var Ie=new PasswordValidator({root:e.root,store:e.store,data:Be,_bind(a,t){var s={};!he.valid&&a.valid&&(s.valid=t.valid),e._set(s),he={}}});function Oe(){we=!0,e.set({confirm_pass:de.value}),we=!1}e.root._beforecreate.push(()=>{Ie._bind({valid:1},Ie.get())});var $e={icon_size:"small",classes:"is-primary is-pulled-right",text:"Update Password",cy:"save-password-button"};void 0!==a.password_tracker&&($e.tracker=a.password_tracker,be.tracker=!0);var ze=new SubmitButton({root:e.root,store:e.store,data:$e,_bind(a,t){var s={};!be.tracker&&a.tracker&&(s.password_tracker=t.tracker),e._set(s),be={}}});e.root._beforecreate.push(()=>{ze._bind({tracker:1},ze.get())});var Ke=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Update Password"}});function qe(a){e.updatePassword(a)}var Ge={is_loading:a.is_loading,is_error:a.is_error,error_message:a.error_message},Re=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:Ge});return{c(){t=createElement("div"),s=createElement("a"),ke._fragment.c(),r=createText(" "),(n=createElement("span")).textContent="Back to Dashboard",Ee._fragment.c(),o=createText("\r\n\r\n    "),xe&&xe.c(),d=createText("\r\n\r\n      "),ye&&ye.c(),l=createText("\r\n\r\n      "),i=createElement("div"),p=createElement("div"),c=createElement("form"),u=createElement("div"),m=createElement("p"),(_=createElement("label")).textContent="Username",v=createText("\r\n                  "),f=createElement("input"),h=createText("\r\n              "),w=createElement("div"),b=createElement("p"),(k=createElement("label")).textContent="Email",N=createText("\r\n                  "),E=createElement("input"),y=createText("\r\n              "),T=createElement("div"),P=createElement("p"),(L=createElement("label")).textContent="Name",F=createText("\r\n                  "),S=createElement("input"),M=createText("\r\n              "),A=createElement("div"),V=createElement("p"),(D=createElement("label")).textContent="Surname",U=createText("\r\n                  "),j=createElement("input"),B=createText("\r\n              "),I=createElement("div"),O=createElement("p"),Ce._fragment.c(),Me._fragment.c(),$=createText("\r\n\r\n        "),z=createElement("div"),K=createElement("div"),q=createElement("div"),G=createElement("figure"),Ve&&Ve.c(),R=createText("\r\n              "),De._fragment.c(),Ue._fragment.c(),Y=createText("\r\n          "),H=createElement("form"),J=createElement("div"),Q=createElement("p"),(W=createElement("label")).textContent="New Password",X=createText("\r\n                  "),Z=createElement("input"),ae=createText("\r\n                  "),Ie._fragment.c(),te=createText("\r\n              "),se=createElement("div"),re=createElement("p"),(ne=createElement("label")).textContent="Confirm Password",oe=createText("\r\n                  "),de=createElement("input"),ie=createText("\r\n              "),pe=createElement("div"),ce=createElement("p"),ze._fragment.c(),Ke._fragment.c(),Re._fragment.c(),s.className="button is-info is-inverted is-pulled-right",s.href="#dashboard",_.className="label",addListener(f,"input",Te),f.className=g="input "+(""==a.data.username?"is-danger":""),setAttribute(f,"type","text"),m.className="control",u.className="field",k.className="label",addListener(E,"input",Pe),E.className=x="input "+(""==a.data.email?"is-danger":""),setAttribute(E,"type","email"),E.dataset.cy="user-email",b.className="control",w.className="field",L.className="label",addListener(S,"input",Le),S.className=C="input "+(""==a.data.name?"is-danger":""),setAttribute(S,"type","text"),S.dataset.cy="user-name",P.className="control",T.className="field",D.className="label",addListener(j,"input",Fe),j.className="input",setAttribute(j,"type","text"),V.className="control",A.className="field",O.className="control",I.className="field",addListener(c,"submit",Ae),p.className="column is-7",G.className="image is-128x128",setStyle(G,"margin","0 auto 20px auto"),q.className="is-text-centered",W.className="label",addListener(Z,"input",je),Z.className=ee="input "+(a.new_pass&&!a.valid?"is-danger":""),setAttribute(Z,"type","password"),Z.dataset.cy="user-password",Q.className="control",J.className="field",ne.className="label",addListener(de,"input",Oe),de.className=le="input "+(a.new_pass!=a.confirm_pass?"is-danger":""),setAttribute(de,"type","password"),de.dataset.cy="user-confirm-password",re.className="control",se.className="field",ce.className="control",pe.className="field",addListener(H,"submit",qe),z.className="column",i.className="columns",t.className="page-content"},m(e,g){insert(e,t,g),append(Ee._slotted.default,s),ke._mount(s,null),append(s,r),append(s,n),Ee._mount(t,null),append(t,o),xe&&xe.m(Re._slotted.default,null),append(Re._slotted.default,d),ye&&ye.m(Re._slotted.default,null),append(Re._slotted.default,l),append(Re._slotted.default,i),append(i,p),append(p,c),append(Me._slotted.default,u),append(u,m),append(m,_),append(m,v),append(m,f),f.value=a.data.username,append(Me._slotted.default,h),append(Me._slotted.default,w),append(w,b),append(b,k),append(b,N),append(b,E),E.value=a.data.email,append(Me._slotted.default,y),append(Me._slotted.default,T),append(T,P),append(P,L),append(P,F),append(P,S),S.value=a.data.name,append(Me._slotted.default,M),append(Me._slotted.default,A),append(A,V),append(V,D),append(V,U),append(V,j),j.value=a.data.surname,append(Me._slotted.default,B),append(Me._slotted.default,I),append(I,O),Ce._mount(O,null),Me._mount(c,null),append(i,$),append(i,z),append(Ue._slotted.default,K),append(K,q),append(q,G),Ve&&Ve.m(G,null),append(K,R),De._mount(K,null),Ue._mount(z,null),append(z,Y),append(z,H),append(Ke._slotted.default,J),append(J,Q),append(Q,W),append(Q,X),append(Q,Z),Z.value=a.new_pass,append(Q,ae),Ie._mount(Q,null),append(Ke._slotted.default,te),append(Ke._slotted.default,se),append(se,re),append(re,ne),append(re,oe),append(re,de),de.value=a.confirm_pass,append(Ke._slotted.default,ie),append(Ke._slotted.default,pe),append(pe,ce),ze._mount(ce,null),Ke._mount(H,null),Re._mount(t,null)},p(t,s){a=s;var r={};t.page&&(r.page=a.page),Ee._set(r),a.tracker.error?xe?xe.p(t,a):((xe=create_if_block_2(e,a)).c(),xe.m(d.parentNode,d)):xe&&(xe.d(1),xe=null),a.should_change_password?ye||((ye=create_if_block_1(e,a)).c(),ye.m(l.parentNode,l)):ye&&(ye.d(1),ye=null),!ue&&t.data&&(f.value=a.data.username),t.data&&g!==(g="input "+(""==a.data.username?"is-danger":""))&&(f.className=g),!me&&t.data&&(E.value=a.data.email),t.data&&x!==(x="input "+(""==a.data.email?"is-danger":""))&&(E.className=x),!_e&&t.data&&(S.value=a.data.name),t.data&&C!==(C="input "+(""==a.data.name?"is-danger":""))&&(S.className=C),!ve&&t.data&&(j.value=a.data.surname);var n={};!fe.tracker&&t.tracker&&(n.tracker=a.tracker,fe.tracker=void 0!==a.tracker),Ce._set(n),fe={},a.data&&a.data.avatarurl?Ve?Ve.p(t,a):((Ve=create_if_block(e,a)).c(),Ve.m(G,null)):Ve&&(Ve.d(1),Ve=null),!ge&&t.new_pass&&(Z.value=a.new_pass),(t.new_pass||t.valid)&&ee!==(ee="input "+(a.new_pass&&!a.valid?"is-danger":""))&&(Z.className=ee);var o={};t.new_pass&&(o.new_pass=a.new_pass),!he.valid&&t.valid&&(o.valid=a.valid,he.valid=void 0!==a.valid),Ie._set(o),he={},!we&&t.confirm_pass&&(de.value=a.confirm_pass),(t.new_pass||t.confirm_pass)&&le!==(le="input "+(a.new_pass!=a.confirm_pass?"is-danger":""))&&(de.className=le);var i={};!be.tracker&&t.password_tracker&&(i.tracker=a.password_tracker,be.tracker=void 0!==a.password_tracker),ze._set(i),be={};var p={};t.is_loading&&(p.is_loading=a.is_loading),t.is_error&&(p.is_error=a.is_error),t.error_message&&(p.error_message=a.error_message),Re._set(p)},d(e){e&&detachNode(t),ke.destroy(),Ee.destroy(),xe&&xe.d(),ye&&ye.d(),removeListener(f,"input",Te),removeListener(E,"input",Pe),removeListener(S,"input",Le),removeListener(j,"input",Fe),Ce.destroy(),Me.destroy(),removeListener(c,"submit",Ae),Ve&&Ve.d(),De.destroy(),Ue.destroy(),removeListener(Z,"input",je),Ie.destroy(),removeListener(de,"input",Oe),ze.destroy(),Ke.destroy(),removeListener(H,"submit",qe),Re.destroy()}}}function create_if_block_2(e,a){var t,s=new Notification({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger"}});return{c(){t=createText(a.error_message),s._fragment.c()},m(e,a){append(s._slotted.default,t),s._mount(e,a)},p(e,a){e.error_message&&setData(t,a.error_message)},d(e){s.destroy(e)}}}function create_if_block_1(e,a){var t,s,r,n=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger"}});return{c(){(t=createElement("h2")).textContent="Please change your password.",s=createText("\r\n          "),(r=createElement("h3")).textContent="You will not be able to access any other pages until you have changed your password.",n._fragment.c(),t.className="title is-4 has-text-danger",r.className="subtitle is-5 has-text-danger"},m(e,a){append(n._slotted.default,t),append(n._slotted.default,s),append(n._slotted.default,r),n._mount(e,a)},d(e){n.destroy(e)}}}function create_if_block(e,a){var t,s;return{c(){(t=createElement("img")).src=s=a.data.avatarurl,t.alt=""},m(e,a){insert(e,t,a)},p(e,a){e.data&&s!==(s=a.data.avatarurl)&&(t.src=s)},d(e){e&&detachNode(t)}}}function Profile(e){init(this,e),this._state=assign(assign(this.store._init(["user"]),data()),e.data),this.store._add(this,["user"]),this._recompute({$user:1},this._state),this._intro=!0,this._handlers.state=[onstate],this._handlers.destroy=[removeFromStore],onstate.call(this,{changed:assignTrue({},this._state),current:this._state}),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}assign(Profile.prototype,proto),assign(Profile.prototype,methods),Profile.prototype._recompute=function(e,a){e.$user&&this._differs(a.should_change_password,a.should_change_password=should_change_password(a))&&(e.should_change_password=!0)};export default Profile;
//# sourceMappingURL=Profile.js.map
