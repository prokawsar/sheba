var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{a as append,b as assign,c as assignTrue,u as createComment,d as createElement,e as createFragment,f as createText,g as detachNode,h as flush,i as init,j as insert,l as proto,m as removeFromStore,C as setAttribute,w as setData,n as Icon,y as Notification,x as Panel,o as Message,q as ViewScaffold,r as PageTitle}from"./chunk-b74ece54.js";import{a as Router}from"./chunk-186691d9.js";import{c as ConfirmButton}from"./chunk-a0c19dba.js";import{a as Remedies}from"./chunk-3b9a27cc.js";import{a as Model}from"./chunk-107a8f39.js";import{a as niceDate}from"./chunk-2e16b4c0.js";import{a as PatientDetails}from"./chunk-1b14df2e.js";import{a as Timeline}from"./chunk-e8abfd15.js";import{a as TreatmentModel,b as AddTreatment}from"./chunk-fc8291ce.js";function entityId({$nav:e}){return e&&e.params[0]}function remedy_names({remedies:e}){let t=[];for(let a in e){let r=e[a];t.push(r.name)}return t}function data(){return{is_loading:!1,is_error:!1,error_message:"",remedies:{},data:{},meta:{},add_remedy:!1,tracker:{saving:!1,saved:!1,error:!1},page:{title:"View Prescription",subtitle:"Patients prescription details",icon:"building-o",icon_badge:"pencil"}}}var methods={load(){var{entityId:e}=this.get();this.set({is_loading:!0,is_error:!1}),Model&&Model.getOne(e).then(e=>{this.set({is_loading:!1,meta:e._meta,data:e.response})}).catch(e=>{var t="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(t=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:t})})},loadRemedies(){Remedies.getAll({limit:1e3}).then(e=>{this.set({remedies:e.response})}).catch(e=>{console.log(e)})},savePrescription(e){let{data:t,entityId:a}=this.get(),r={prescribe:{id:a,patient:t.patient.id},data:e};this.set({tracker:{saving:!0,saved:!1,error:!1}}),TreatmentModel.createWithCase(r).then(e=>{this.set({tracker:{saving:!1,saved:!0,error:!1}}),setTimeout(()=>{this.set({tracker:{saved:!1},add_remedy:!1}),this.load()},1500)}).catch(e=>{console.log(e)})}};function oncreate(){var{entityId:e}=this.get();this.on("saveTreatment",e=>{this.savePrescription(e)}),this.on("editPrescription",e=>{console.log(e),this.set({add_remedy:!0,selected_remedies:e})}),this.load(),this.loadRemedies()}function create_main_fragment(e,t){var a,r,d,s,o,n,i,m,c,_,l,p,u,f,y,g,h,v,k,b,T=new Icon({root:e.root,store:e.store,data:{icon:"long-arrow-left",size:"small"}}),w={page:t.page},N=new PageTitle({root:e.root,store:e.store,slots:{default:createFragment()},data:w}),P=t.tracker.error&&create_if_block_2(e,t),E=t.data.patient&&create_if_block_1(e,t);function x(e){return e.add_remedy?create_if_block:create_else_block}var V=x(t),I=V(e,t),j=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"light",size:"large"}}),D=new Panel({root:e.root,store:e.store,slots:{default:createFragment(),toolbar:createFragment()},data:{title:"Prescription Details",has_toolbar:!0}}),F={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message},M=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:F});return{c(){a=createElement("div"),r=createElement("a"),T._fragment.c(),d=createText("\r\n      "),(s=createElement("span")).textContent="Back to All Prescriptions",N._fragment.c(),o=createText("\r\n\r\n  "),P&&P.c(),n=createText("\r\n\r\n    "),i=createElement("div"),m=createElement("a"),(c=createElement("span")).innerHTML='<i class="fa fa-eye"></i>',_=createText("\r\n          "),(l=createElement("span")).textContent="View case history",u=createText("\r\n\r\n      "),f=createElement("div"),y=createElement("div"),E&&E.c(),g=createText("\r\n        "),h=createElement("div"),v=createElement("div"),k=createElement("div"),I.c(),b=createComment(),j._fragment.c(),D._fragment.c(),M._fragment.c(),r.className="button is-info is-pulled-right",r.href="#prescriptions",c.className="icon is-small",setAttribute(m,"type","button"),m.className="button is-gray",m.href=p="/#history/view/"+t.entityId,setAttribute(i,"slot","toolbar"),y.className="column",k.className="column",v.className="columns",h.className="column",f.className="columns",a.className="page-content"},m(e,t){insert(e,a,t),append(N._slotted.default,r),T._mount(r,null),append(r,d),append(r,s),N._mount(a,null),append(a,o),P&&P.m(M._slotted.default,null),append(M._slotted.default,n),append(D._slotted.toolbar,i),append(i,m),append(m,c),append(m,_),append(m,l),append(D._slotted.default,u),append(D._slotted.default,f),append(f,y),E&&E.m(y,null),append(f,g),append(f,h),append(h,v),append(v,k),I.m(j._slotted.default,null),append(j._slotted.default,b),j._mount(k,null),D._mount(M._slotted.default,null),M._mount(a,null)},p(t,a){var r={};t.page&&(r.page=a.page),N._set(r),a.tracker.error?P?P.p(t,a):((P=create_if_block_2(e,a)).c(),P.m(n.parentNode,n)):P&&(P.d(1),P=null),t.entityId&&p!==(p="/#history/view/"+a.entityId)&&(m.href=p),a.data.patient?E?E.p(t,a):((E=create_if_block_1(e,a)).c(),E.m(y,null)):E&&(E.d(1),E=null),V===(V=x(a))&&I?I.p(t,a):(I.d(1),(I=V(e,a)).c(),I.m(b.parentNode,b));var d={};t.is_loading&&(d.is_loading=a.is_loading),t.is_error&&(d.is_error=a.is_error),t.error_message&&(d.error_message=a.error_message),M._set(d)},d(e){e&&detachNode(a),T.destroy(),N.destroy(),P&&P.d(),E&&E.d(),I.d(),j.destroy(),D.destroy(),M.destroy()}}}function create_if_block_2(e,t){var a,r=new Notification({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger"}});return{c(){a=createText(t.error_message),r._fragment.c()},m(e,t){append(r._slotted.default,a),r._mount(e,t)},p(e,t){e.error_message&&setData(a,t.error_message)},d(e){r.destroy(e)}}}function create_if_block_1(e,t){var a,r,d={data:t.data.patient},s=new PatientDetails({root:e.root,store:e.store,data:d});return{c(){(a=createElement("p")).textContent="Patient Details",r=createText("\r\n\r\n        "),s._fragment.c(),a.className="title is-5"},m(e,t){insert(e,a,t),insert(e,r,t),s._mount(e,t)},p(e,t){var a={};e.data&&(a.data=t.data.patient),s._set(a)},d(e){e&&(detachNode(a),detachNode(r)),s.destroy(e)}}}function create_else_block(e,t){var a={},r={};void 0!==t.data&&(r.data=t.data,a.data=!0),void 0!==t.add_remedy&&(r.add_remedy=t.add_remedy,a.add_remedy=!0);var d=new Timeline({root:e.root,store:e.store,data:r,_bind(t,r){var d={};!a.data&&t.data&&(d.data=r.data),!a.add_remedy&&t.add_remedy&&(d.add_remedy=r.add_remedy),e._set(d),a={}}});return e.root._beforecreate.push(()=>{d._bind({data:1,add_remedy:1},d.get())}),d.on("editPrescription",function(t){e.fire("editPrescription",t)}),{c(){d._fragment.c()},m(e,t){d._mount(e,t)},p(e,r){t=r;var s={};!a.data&&e.data&&(s.data=t.data,a.data=void 0!==t.data),!a.add_remedy&&e.add_remedy&&(s.add_remedy=t.add_remedy,a.add_remedy=void 0!==t.add_remedy),d._set(s),a={}},d(e){d.destroy(e)}}}function create_if_block(e,t){var a={},r={prescribe:!0};void 0!==t.remedy_names&&(r.remedy_names=t.remedy_names,a.remedy_names=!0),void 0!==t.data&&(r.data=t.data,a.data=!0),void 0!==t.selected_remedies&&(r.selected_remedies=t.selected_remedies,a.selected_remedies=!0),void 0!==t.tracker&&(r.tracker=t.tracker,a.tracker=!0),void 0!==t.add_remedy&&(r.add_remedy=t.add_remedy,a.add_remedy=!0);var d=new AddTreatment({root:e.root,store:e.store,data:r,_bind(t,r){var d={};!a.remedy_names&&t.remedy_names&&(d.remedy_names=r.remedy_names),!a.data&&t.data&&(d.data=r.data),!a.selected_remedies&&t.selected_remedies&&(d.selected_remedies=r.selected_remedies),!a.tracker&&t.tracker&&(d.tracker=r.tracker),!a.add_remedy&&t.add_remedy&&(d.add_remedy=r.add_remedy),e._set(d),a={}}});return e.root._beforecreate.push(()=>{d._bind({remedy_names:1,data:1,selected_remedies:1,tracker:1,add_remedy:1},d.get())}),d.on("saveTreatment",function(t){e.fire("saveTreatment",t)}),{c(){d._fragment.c()},m(e,t){d._mount(e,t)},p(e,r){t=r;var s={};!a.remedy_names&&e.remedy_names&&(s.remedy_names=t.remedy_names,a.remedy_names=void 0!==t.remedy_names),!a.data&&e.data&&(s.data=t.data,a.data=void 0!==t.data),!a.selected_remedies&&e.selected_remedies&&(s.selected_remedies=t.selected_remedies,a.selected_remedies=void 0!==t.selected_remedies),!a.tracker&&e.tracker&&(s.tracker=t.tracker,a.tracker=void 0!==t.tracker),!a.add_remedy&&e.add_remedy&&(s.add_remedy=t.add_remedy,a.add_remedy=void 0!==t.add_remedy),d._set(s),a={}},d(e){d.destroy(e)}}}function ViewPrescription(e){init(this,e),this._state=assign(assign(this.store._init(["nav"]),data()),e.data),this.store._add(this,["nav"]),this._recompute({$nav:1,remedies:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}assign(ViewPrescription.prototype,proto),assign(ViewPrescription.prototype,methods),ViewPrescription.prototype._recompute=function(e,t){e.$nav&&this._differs(t.entityId,t.entityId=entityId(t))&&(e.entityId=!0),e.remedies&&this._differs(t.remedy_names,t.remedy_names=remedy_names(t))&&(e.remedy_names=!0)};export default ViewPrescription;
//# sourceMappingURL=ViewPrescription.js.map
