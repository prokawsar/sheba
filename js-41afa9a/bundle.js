var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{a as append,b as assign,c as assignTrue,d as createElement,e as createFragment,f as createText,g as detachNode,h as flush,i as init,j as insert,k as noop,l as proto,m as removeFromStore,n as Icon,o as Message,p as Transition,q as ViewScaffold,r as PageTitle,s as baseModel,t as Net,u as createComment,v as destroyEach,w as setData,x as Panel,y as Notification,z as Loader,A as addListener,B as removeListener,C as setAttribute,D as setStyle,E as blankObject,F as destroyBlock,G as updateKeyedEach,H as _differs,I as _differsImmutable,J as get,K as on,L as fire,M as commonjsGlobal,N as createCommonjsModule}from"./chunk-b74ece54.js";import{a as Router,b as Access}from"./chunk-186691d9.js";for(var routes=["profile","settings"],routeMap={},i=0;i<routes.length;i++){var route=routes[i];routeMap[route]=[{pattern:"/",view:route.charAt(0).toUpperCase()+route.slice(1)}]}function has_transition({$settings:e,transition:t}){return void 0!==t?t:e.transition}function is_redirect({$user:e}){return!!e.should_change_password}function data(){return{is_redirect:!1}}routeMap.dashboard=[{pattern:"/",view:"Dashboard"}],routeMap.search=[{pattern:"/",view:"Search"}],routeMap.prescriptions=[{pattern:"/",view:"Prescriptions"},{pattern:"/(\\d+)/?([^/]*)?/?([^/]*)?/?$",view:"Prescriptions",type:"regex"},{pattern:"/view/(\\d+)$",view:"ViewPrescription",type:"regex"}],routeMap.users=[{pattern:"/",view:"Users"},{pattern:"/(\\d+)/?([^/]*)?/?([^/]*)?/?$",view:"Users",type:"regex"},{pattern:"/view/(\\d+)$",view:"ViewUser",type:"regex"},{pattern:"/add",view:"AddUser"}],routeMap.remedies=[{pattern:"/",view:"Remedies"},{pattern:"/(\\d+)/?([^/]*)?/?([^/]*)?/?$",view:"Remedies",type:"regex"},{pattern:"/view/(\\d+)$",view:"ViewRemedy",type:"regex"},{pattern:"/singleview/(\\d+)$",view:"SingleView",type:"regex"},{pattern:"/add",view:"AddRemedy"}],routeMap.patients=[{pattern:"/",view:"Patients"},{pattern:"/(\\d+)/?([^/]*)?/?([^/]*)?/?$",view:"Patients",type:"regex"},{pattern:"/view/(\\d+)$",view:"ViewPatient",type:"regex"},{pattern:"/add",view:"AddPatient"}],routeMap.history=[{pattern:"/",view:"Histories"},{pattern:"/(\\d+)/?([^/]*)?/?([^/]*)?/?$",view:"Histories",type:"regex"},{pattern:"/view/(\\d+)$",view:"ViewHistory",type:"regex"},{pattern:"/add",view:"AddHistory"}];var methods={redirectToProfile(){var{is_redirect:e}=this.get();e&&Router.navigate("profile")}};function oncreate(){}function onstate({changed:e,current:t,previous:a}){e.$user&&this.redirectToProfile()}function create_main_fragment(e,t){var a,s,n,r,i,o,d,c,l=new Icon({root:e.root,store:e.store,data:{size:"large",icon:"chain-broken"}}),p=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger",size:"large"}}),u=new Transition({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"fly",y:20}});return{c(){a=createElement("div"),s=createElement("div"),n=createElement("h1"),l._fragment.c(),r=createText("\r\n          "),i=createElement("br"),o=createText("\r\n          404 Error"),d=createText("\r\n        "),(c=createElement("h4")).textContent="The page you requested could not be found.",p._fragment.c(),u._fragment.c(),n.className="has-text-centered title has-text-danger",c.className="has-text-centered subtitle has-text-danger",s.className="inner-content",a.className="page-content"},m(e,t){insert(e,a,t),append(a,s),append(p._slotted.default,n),l._mount(n,null),append(n,r),append(n,i),append(n,o),append(p._slotted.default,d),append(p._slotted.default,c),p._mount(u._slotted.default,null),u._mount(s,null)},p:noop,d(e){e&&detachNode(a),l.destroy(),p.destroy(),u.destroy()}}}function PageNotFound(e){init(this,e),this._state=assign(assign(this.store._init(["settings","user"]),data()),e.data),this.store._add(this,["settings","user"]),this._recompute({$settings:1,transition:1,$user:1},this._state),this._intro=!0,this._handlers.state=[onstate],this._handlers.destroy=[removeFromStore],onstate.call(this,{changed:assignTrue({},this._state),current:this._state}),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function data$1(){return{is_loading:!0,page:{title:"Loading Assets",subtitle:"Please wait...",icon:"dot-circle-o"}}}function oncreate$1(){this.timeout=setTimeout(()=>{let{is_loading:e,page:t}=this.get();e=!1,t.title="Error",t.subtitle="Failed to load assets",this.set({is_loading:e,page:t})},1e4)}function ondestroy(){this&&this.timeout&&clearTimeout(this.timeout)}function create_main_fragment$1(e,t){var a,s,n,r,i,o,d,c={page:t.page},l=new PageTitle({root:e.root,store:e.store,data:c}),p=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"danger"}}),u={is_loading:t.is_loading},m=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:u});return{c(){a=createElement("div"),l._fragment.c(),s=createText("\r\n\r\n    "),(n=createElement("p")).textContent="It seems like assets for this page could not be loaded.",r=createText("\r\n        "),(i=createElement("p")).innerHTML="<br>You can wait a few seconds extra and see if it works.",o=createText("\r\n        "),(d=createElement("p")).textContent="If not, reload the admin panel, there may have been an update in the background.",p._fragment.c(),m._fragment.c(),a.className="page-content"},m(e,t){insert(e,a,t),l._mount(a,null),append(a,s),append(p._slotted.default,n),append(p._slotted.default,r),append(p._slotted.default,i),append(p._slotted.default,o),append(p._slotted.default,d),p._mount(m._slotted.default,null),m._mount(a,null)},p(e,t){var a={};e.page&&(a.page=t.page),l._set(a);var s={};e.is_loading&&(s.is_loading=t.is_loading),m._set(s)},d(e){e&&detachNode(a),l.destroy(),p.destroy(),m.destroy()}}}function PageAssetsLoading(e){init(this,e),this._state=assign(data$1(),e.data),this._intro=!0,this._handlers.destroy=[ondestroy],this._fragment=create_main_fragment$1(this,this._state),this.root._oncreate.push(()=>{oncreate$1.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function is_admin_user({$role:e}){return"A"==e||"U"==e}function data$2(){return{tracker:{saving:!1,saved:!1,error:!1},is_loading:!0,is_error:!1,meta:{},error_message:"",short_meanings:{Aggravation:"agg."}}}function oncreate$2(){this.set({is_loading:!1})}function get_each_context(e,t,a){const s=Object.create(e);return s.key=t[a][0],s.value=t[a][1],s}function create_main_fragment$2(e,t){for(var a,s,n,r,i=t.Object.entries(t.short_meanings),o=[],d=0;d<i.length;d+=1)o[d]=create_each_block(e,get_each_context(t,i,d));var c=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"info"}}),l=new Panel({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Symptoms Writting Guideline"}}),p={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message},u=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:p});return{c(){a=createElement("div"),s=createElement("div"),n=createElement("div");for(var e=0;e<o.length;e+=1)o[e].c();r=createComment(),c._fragment.c(),l._fragment.c(),u._fragment.c(),n.className="column is-12",s.className="columns is-multiline",a.className="page-content"},m(e,t){insert(e,a,t),append(u._slotted.default,s),append(s,n);for(var i=0;i<o.length;i+=1)o[i].m(c._slotted.default,null);append(c._slotted.default,r),c._mount(l._slotted.default,null),l._mount(n,null),u._mount(a,null)},p(t,a){if(t.Object||t.short_meanings){i=a.Object.entries(a.short_meanings);for(var s=0;s<i.length;s+=1){const n=get_each_context(a,i,s);o[s]?o[s].p(t,n):(o[s]=create_each_block(e,n),o[s].c(),o[s].m(r.parentNode,r))}for(;s<o.length;s+=1)o[s].d(1);o.length=i.length}var n={};t.is_loading&&(n.is_loading=a.is_loading),t.is_error&&(n.is_error=a.is_error),t.error_message&&(n.error_message=a.error_message),u._set(n)},d(e){e&&detachNode(a),destroyEach(o,e),c.destroy(),l.destroy(),u.destroy()}}}function create_each_block(e,t){var a,s,n,r=t.key,i=t.value;return{c(){a=createText(r),s=createText(" = "),n=createText(i)},m(e,t){insert(e,a,t),insert(e,s,t),insert(e,n,t)},p(e,t){(e.Object||e.short_meanings)&&r!==(r=t.key)&&setData(a,r),(e.Object||e.short_meanings)&&i!==(i=t.value)&&setData(n,i)},d(e){e&&(detachNode(a),detachNode(s),detachNode(n))}}}function Dashboard(e){init(this,e),this._state=assign(assign(assign({Object:Object},this.store._init(["role"])),data$2()),e.data),this.store._add(this,["role"]),this._recompute({$role:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$2(this,this._state),this.root._oncreate.push(()=>{oncreate$2.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function data$3(){return{views:{PageNotFound:PageNotFound,Dashboard:Dashboard,PageAssetsLoading:PageAssetsLoading},lazyViews:{Profile:()=>import("./Profile.js"),Settings:()=>import("./Settings.js"),Users:()=>import("./Users.js"),AddUser:()=>import("./AddUser.js"),ViewUser:()=>import("./ViewUser.js"),Remedies:()=>import("./Remedies.js"),ViewRemedy:()=>import("./ViewRemedy.js"),AddRemedy:()=>import("./AddRemedy.js"),SingleView:()=>import("./SingleView.js"),Patients:()=>import("./Patients.js"),ViewPatient:()=>import("./ViewPatient.js"),AddPatient:()=>import("./AddPatient.js"),Histories:()=>import("./Histories.js"),ViewHistory:()=>import("./ViewHistory.js"),AddHistory:()=>import("./AddHistory.js"),Search:()=>import("./Search.js"),Prescriptions:()=>import("./Prescriptions.js"),ViewPrescription:()=>import("./ViewPrescription.js")}}}assign(PageNotFound.prototype,proto),assign(PageNotFound.prototype,methods),PageNotFound.prototype._recompute=function(e,t){(e.$settings||e.transition)&&this._differs(t.has_transition,t.has_transition=has_transition(t))&&(e.has_transition=!0),e.$user&&this._differs(t.is_redirect,t.is_redirect=is_redirect(t))&&(e.is_redirect=!0)},assign(PageAssetsLoading.prototype,proto),new class extends baseModel{constructor(){super(),this.apiEndpoint="/dashboard"}},assign(Dashboard.prototype,proto),Dashboard.prototype._recompute=function(e,t){e.$role&&this._differs(t.is_admin_user,t.is_admin_user=is_admin_user(t))&&(e.is_admin_user=!0)};var methods$1={loadQueuedView(e){var{lazyViews:t}=this.get();void 0!==t[e]&&(0,t[e])().then(t=>{var{views:a}=this.get();a[e]=t.default?t.default:t,this.set({views:a});var{nav:s}=this.store.get();s.shouldBeView==e&&(s.activeView=e,this.store.set({nav:s}))}).catch(t=>{console.log(t,"Module for "+e+" not found")})},init(){this.on("routeChange",e=>{var t=e.view,{nav:a}=this.store.get(),{views:s,lazyViews:n}=this.get(),r=(a.activeView,t);"404"==t?t="PageNotFound":void 0===s[t]&&(void 0===n[t]?t="PageNotFound":(this.loadQueuedView(t),t="PageAssetsLoading")),a={activeView:t,shouldBeView:r,activeTab:e.section?e.section:t,params:e.params},this.store.set({nav:a}),this.fire("hideSidebar")}),Router.init(this,routeMap,"dashboard")}};function oncreate$3(){this.init()}function create_main_fragment$3(e,t){var a,s=t.views[t.$nav.activeView];function n(t){return{root:e.root,store:e.store}}if(s)var r=new s(n());function i(t){e.fire("updateLoggedIn",t)}function o(t){e.fire("hideSidebar",t)}return r&&r.on("updateLoggedIn",i),r&&r.on("hideSidebar",o),{c(){a=createElement("div"),r&&r._fragment.c(),a.className="app-content"},m(t,s){insert(t,a,s),r&&r._mount(a,null),e.refs.routeOutput=a},p(e,t){s!==(s=t.views[t.$nav.activeView])&&(r&&r.destroy(),s?((r=new s(n()))._fragment.c(),r._mount(a,null),r.on("updateLoggedIn",i),r.on("hideSidebar",o)):r=null)},d(t){t&&detachNode(a),r&&r.destroy(),e.refs.routeOutput===a&&(e.refs.routeOutput=null)}}}function RouteHandler(e){init(this,e),this.refs={},this._state=assign(assign(this.store._init(["nav"]),data$3()),e.data),this.store._add(this,["nav"]),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$3(this,this._state),this.root._oncreate.push(()=>{oncreate$3.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function randomBackground({images:e}){var t=e.length;return"/images/"+e[Math.floor(Math.random()*(t-0+1))+0]}function show({$is_logged_in:e,$is_loading:t}){return!e||t}function loading({$is_loading:e}){return e}function isReady({username:e,password:t,validating:a}){return""!=e&&""!=t||a}function data$4(){return{validating:!1,shaking:!1,username:"",password:"",error_message:"",has_error:!1,images:["bg11.jpg","bg1.jpg","bg2.jpg","bg3.jpg","bg9.jpg","bg10.jpg"]}}assign(RouteHandler.prototype,proto),assign(RouteHandler.prototype,methods$1);var methods$2={valid(){this.set({validating:!1,username:"",password:""})},invalid(){this.set({validating:!1,shaking:!0}),setTimeout(()=>{this.set({shaking:!1,password:""})},500)}};function oncreate$4(){this.on("login",e=>{e.preventDefault();var{validating:t}=this.get();t||(this.set({validating:!0}),this.fire("validatelogin",this))})}function create_main_fragment$4(e,t){var a,s,n,r,i,o,d,c,l,p,u,m;function h(e){return e.has_error?create_if_block:create_else_block}var g=h(t),_=g(e,t);return{c(){a=createElement("div"),s=createElement("div"),n=createElement("div"),r=createElement("div"),i=createElement("div"),o=createText("\r\n        "),d=createElement("img"),c=createText("\r\n\r\n      "),l=createElement("div"),_.c(),p=createText("\r\n        "),(u=createElement("p")).innerHTML='<span class="app-loader">Loading ...</span>',i.className="is-overlay",setStyle(i,"background-image","url("+t.randomBackground+")"),d.alt="logo",d.src="images/logo.png",r.className="column is-half logo is-text-centered",l.className="column is-half login-box",n.className="columns",s.className="hero-body",a.id="login",a.className=m="hero is-fullheight "+(t.show?"is-showing":"")+" "+(t.loading?"is-loading":""),a.dataset.cy="login"},m(e,t){insert(e,a,t),append(a,s),append(s,n),append(n,r),append(r,i),append(r,o),append(r,d),append(n,c),append(n,l),_.m(l,null),append(l,p),append(l,u)},p(t,s){t.randomBackground&&setStyle(i,"background-image","url("+s.randomBackground+")"),g===(g=h(s))&&_?_.p(t,s):(_.d(1),(_=g(e,s)).c(),_.m(l,p)),(t.show||t.loading)&&m!==(m="hero is-fullheight "+(s.show?"is-showing":"")+" "+(s.loading?"is-loading":""))&&(a.className=m)},d(e){e&&detachNode(a),_.d()}}}function create_else_block(e,t){var a,s,n,r,i,o,d,c,l,p,u,m,h,g,_,f,v,y,w,b=!1,N=!1;function E(){b=!0,e.set({username:i.value}),b=!1}var $=new Icon({root:e.root,store:e.store,data:{icon:"user",icon_class:"is-left"}});function x(){N=!0,e.set({password:p.value}),N=!1}var T=new Icon({root:e.root,store:e.store,data:{icon:"key",icon_class:"is-left"}});function k(t){e.fire("login",t)}return{c(){a=createElement("div"),s=createElement("form"),n=createElement("div"),r=createElement("div"),i=createElement("input"),o=createText("\r\n                  "),$._fragment.c(),d=createText("\r\n              "),c=createElement("div"),l=createElement("div"),p=createElement("input"),u=createText("\r\n                  "),T._fragment.c(),m=createText("\r\n              "),h=createElement("div"),g=createElement("div"),_=createElement("button"),f=createText("Log In"),addListener(i,"input",E),i.className="input is-medium",setAttribute(i,"type","text"),i.name="username",i.placeholder="Username",i.dataset.cy="username",r.className="control has-icons-left",n.className="field",addListener(p,"input",x),p.className="input is-medium",setAttribute(p,"type","password"),p.name="password",p.placeholder="Password",p.dataset.cy="password",l.className="control has-icons-left",c.className="field",_.type="submit",_.className=v="button is-medium is-fullwidth is-primary "+(t.validating?"is-loading":""),_.disabled=y=!t.isReady,_.dataset.cy="login-button",g.className="control",h.className="field",addListener(s,"submit",k),a.className=w="form-holder "+(t.shaking?"is-shaking":"")},m(e,v){insert(e,a,v),append(a,s),append(s,n),append(n,r),append(r,i),i.value=t.username,append(r,o),$._mount(r,null),append(s,d),append(s,c),append(c,l),append(l,p),p.value=t.password,append(l,u),T._mount(l,null),append(s,m),append(s,h),append(h,g),append(g,_),append(_,f)},p(e,t){!b&&e.username&&(i.value=t.username),!N&&e.password&&(p.value=t.password),e.validating&&v!==(v="button is-medium is-fullwidth is-primary "+(t.validating?"is-loading":""))&&(_.className=v),e.isReady&&y!==(y=!t.isReady)&&(_.disabled=y),e.shaking&&w!==(w="form-holder "+(t.shaking?"is-shaking":""))&&(a.className=w)},d(e){e&&detachNode(a),removeListener(i,"input",E),$.destroy(),removeListener(p,"input",x),T.destroy(),removeListener(s,"submit",k)}}}function create_if_block(e,t){var a,s;return{c(){a=createElement("div"),(s=createElement("div")).className="message-body",a.className="message is-danger"},m(e,n){insert(e,a,n),append(a,s),s.innerHTML=t.error_message},p(e,t){e.error_message&&(s.innerHTML=t.error_message)},d(e){e&&detachNode(a)}}}function Login(e){init(this,e),this._state=assign(assign(this.store._init(["is_logged_in","is_loading"]),data$4()),e.data),this.store._add(this,["is_logged_in","is_loading"]),this._recompute({images:1,$is_logged_in:1,$is_loading:1,username:1,password:1,validating:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$4(this,this._state),this.root._oncreate.push(()=>{oncreate$4.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function sections({$mainSections:e,$nav:t}){var a=[];for(var s in e)if(e.hasOwnProperty(s)){var n=e[s],r={name:s,title:n.title?n.title:s,url:n.url,icon:n.icon,visible:n.visible};!1!==n.visible&&a.push(r)}return a}function get_each_context$1(e,t,a){const s=Object.create(e);return s.section=t[a],s.k=a,s}function create_main_fragment$5(e,t){var a,s,n,r=t.$is_logged_in&&create_if_block$1(e,t);return{c(){a=createElement("div"),s=createElement("div"),n=createElement("ul"),r&&r.c(),s.className="tabs is-vertical has-block-icons",a.id="mainNav",a.dataset.cy="main-nav",a.className="has-custom-scrollbar"},m(e,t){insert(e,a,t),append(a,s),append(s,n),r&&r.m(n,null)},p(t,a){a.$is_logged_in?r?r.p(t,a):((r=create_if_block$1(e,a)).c(),r.m(n,null)):r&&(r.d(1),r=null)},d(e){e&&detachNode(a),r&&r.d()}}}function create_if_block$1(e,t){var a,s=[],n=blankObject(),r=t.sections;const i=e=>e.section.name;for(var o=0;o<r.length;o+=1){let a=get_each_context$1(t,r,o),d=i(a);s[o]=n[d]=create_each_block$1(e,d,a)}return{c(){for(o=0;o<s.length;o+=1)s[o].c();a=createComment()},m(e,t){for(o=0;o<s.length;o+=1)s[o].m(e,t);insert(e,a,t)},p(t,r){const o=r.sections;s=updateKeyedEach(s,e,t,i,1,r,o,n,a.parentNode,destroyBlock,create_each_block$1,"m",a,get_each_context$1)},d(e){for(o=0;o<s.length;o+=1)s[o].d(e);e&&detachNode(a)}}}function create_each_block$1(e,t,a){var s,n,r,i,o,d,c,l,p,u=a.section.title,m={icon:a.section.icon,size:"medium"},h=new Icon({root:e.root,store:e.store,data:m});return{key:t,first:null,c(){s=createElement("li"),n=createElement("a"),h._fragment.c(),r=createText(" "),i=createElement("span"),o=createText(u),l=createText("\r\n        "),i.className="nav-item-name",n.href=d="#"+a.section.url,n.dataset.cy=c=a.section.url,s.className=p=a.$nav.activeTab==a.section.name?"is-active":"",this.first=s},m(e,t){insert(e,s,t),append(s,n),h._mount(n,null),append(n,r),append(n,i),append(i,o),append(s,l)},p(e,t){var a={};e.sections&&(a.icon=t.section.icon),h._set(a),e.sections&&u!==(u=t.section.title)&&setData(o,u),e.sections&&d!==(d="#"+t.section.url)&&(n.href=d),e.sections&&c!==(c=t.section.url)&&(n.dataset.cy=c),(e.$nav||e.sections)&&p!==(p=t.$nav.activeTab==t.section.name?"is-active":"")&&(s.className=p)},d(e){e&&detachNode(s),h.destroy()}}}function MainNavigation(e){init(this,e),this._state=assign(this.store._init(["mainSections","nav","is_logged_in"]),e.data),this.store._add(this,["mainSections","nav","is_logged_in"]),this._recompute({$mainSections:1,$nav:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$5(this,this._state),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function userRoleName({$user:e}){if(e&&e.role)switch(e.role){case"SA":return"Super Admin";case"SU":return"Super User"}return""}function data$5(){return{app_state:{show_duplicate_login_modal:!1,show_sidebar:!1},scrollTop:0}}assign(Login.prototype,proto),assign(Login.prototype,methods$2),Login.prototype._recompute=function(e,t){e.images&&this._differs(t.randomBackground,t.randomBackground=randomBackground(t))&&(e.randomBackground=!0),(e.$is_logged_in||e.$is_loading)&&this._differs(t.show,t.show=show(t))&&(e.show=!0),e.$is_loading&&this._differs(t.loading,t.loading=loading(t))&&(e.loading=!0),(e.username||e.password||e.validating)&&this._differs(t.isReady,t.isReady=isReady(t))&&(e.isReady=!0)},assign(MainNavigation.prototype,proto),MainNavigation.prototype._recompute=function(e,t){(e.$mainSections||e.$nav)&&this._differs(t.sections,t.sections=sections(t))&&(e.sections=!0)};var methods$3={scrolling(e){this.set({scrollTop:e.scrollTop})}};function oncreate$5(){var e=this;e.on("logout",function(t){t.preventDefault(),e.fire("logout")})}function create_main_fragment$6(e,t){var a,s,n,r,i,o,d,c,l,p,u,m,h,g,_,f,v,y,w,b,N,E,$,x,T,k,S,A,P,R,j,V,L,M,I,O,D,F,C,H,K,B,U,z,G,Y,J,q,Q,W,X,Z,ee,te,ae,se,ne,re,ie,oe,de,ce,le,pe,ue,me,he,ge,_e,fe,ve,ye,we,be,Ne,Ee,$e,xe,Te,ke,Se,Ae,Pe,Re,je,Ve,Le=t.$user&&t.$user.name,Me=t.$user&&t.$user.surname,Ie=!t.$is_loading&&create_if_block_1(e,t);function Oe(t){e.scrolling(this)}function De(t){e.fire("toggleSidebar")}var Fe=t.$user&&t.$user.avatar&&create_if_block$2(e,t),Ce=new Icon({root:e.root,store:e.store,data:{icon:"angle-down"}}),He=new Icon({root:e.root,store:e.store,data:{icon:"cog"}}),Ke=new Icon({root:e.root,store:e.store,data:{icon:"user-circle-o"}}),Be=new Icon({root:e.root,store:e.store,data:{icon:"sign-out"}});function Ue(t){e.fire("logout",t)}var ze=new MainNavigation({root:e.root,store:e.store});function Ge(t){e.fire("logout",t)}var Ye=new Login({root:e.root,store:e.store});return Ye.on("validatelogin",function(t){e.fire("validatelogin",t)}),{c(){a=createElement("div"),s=createElement("div"),n=createText("There is an update available, please reload window to activate updated version.    \r\n    "),r=createElement("button"),(i=createElement("strong")).textContent="Reload Now",c=createText("\r\n\r\n  "),l=createElement("div"),p=createElement("div"),u=createElement("div"),m=createText("\r\n      "),Ie&&Ie.c(),h=createText("\r\n\r\n    "),g=createElement("div"),_=createElement("div"),f=createElement("div"),v=createElement("button"),y=createElement("span"),w=createText("\r\n            "),b=createElement("span"),N=createText("\r\n            "),E=createElement("span"),x=createText("\r\n          "),T=createElement("div"),k=createElement("img"),S=createText("\r\n            "),A=createElement("span"),P=createText(t.$ENV_MARKER),R=createText("\r\n\r\n\r\n\r\n      "),j=createElement("div"),V=createElement("div"),L=createElement("div"),M=createElement("div"),I=createElement("div"),O=createElement("div"),Fe&&Fe.c(),D=createText("\r\n                "),F=createElement("div"),C=createElement("span"),H=createText(Le),K=createText(" "),B=createText(Me),U=createText("\r\n                  "),z=createElement("small"),G=createText(t.userRoleName),Y=createText("\r\n                "),J=createElement("div"),Ce._fragment.c(),q=createText("\r\n\r\n            "),Q=createElement("div"),W=createElement("div"),X=createElement("a"),He._fragment.c(),Z=createText("\r\n                  "),(ee=createElement("span")).textContent="Settings",te=createText("\r\n                "),ae=createElement("a"),Ke._fragment.c(),se=createText("\r\n                  "),(ne=createElement("span")).textContent="My Profile",re=createText("\r\n\r\n                "),ie=createElement("hr"),oe=createText("\r\n\r\n                "),de=createElement("a"),Be._fragment.c(),ce=createText("\r\n                  "),(le=createElement("span")).textContent="Log out",ue=createText("\r\n\r\n    "),ze._fragment.c(),me=createText("\r\n\r\n    "),he=createElement("div"),ge=createElement("div"),_e=createElement("div"),fe=createText("\r\n        "),ve=createElement("div"),ye=createElement("div"),(we=createElement("h2")).textContent="You have logged in on another device",be=createText("\r\n            "),(Ne=createElement("p")).innerHTML="Your session is no longer valid on this device.\n\t\t\t              <br>\n\t\t\t              <br>",Ee=createText("\r\n            "),($e=createElement("p")).innerHTML="<small><em>You may only log in from one device at a time.\n\t\t\t                  <br> If you log in on this device, you will be logged out of the other device.</em></small>",xe=createText("\r\n\r\n            "),Te=createElement("hr"),ke=createText("\r\n\r\n            "),Se=createElement("div"),Ae=createElement("div"),(Pe=createElement("button")).textContent="Log back in",Ve=createText("\r\n"),Ye._fragment.c(),r.className=o="button is-small is-light "+(t.$update_ready?"is-pulsing":""),setAttribute(r,"onclick","window.location.reload();"),s.id="updateReady",s.className=d=t.$update_ready?"is-update-ready":"",u.id="gradientHilight",addListener(p,"scroll",Oe),p.id="contentArea",addListener(v,"click",De),v.className=$="button navbar-burger\r\n          is-hidden-tablet is-hidden-desktop is-hidden-widescreen is-hidden-fullhd "+(t.app_state.show_sidebar?"is-active":""),k.className="logo",k.src="images/logo.png",k.alt="logo",A.className="env-marker",T.className="logo-holder",f.className="level-item logo-area",_.className="level-left",O.className="media-left",C.className="is-block",setStyle(C,"line-height","1.3rem"),C.dataset.cy="user-name-header",z.className="is-block",z.dataset.cy="user-role",F.className="media-content",setStyle(F,"overflow","hidden"),J.className="media-right",I.className="media",M.className="dropdown-trigger",X.href="#settings/",X.className="dropdown-item",ae.href="#profile/",ae.className="dropdown-item",ae.dataset.cy="profile",ie.className="dropdown-divider",addListener(de,"click",Ue),de.href="#logout",de.className="dropdown-item",de.dataset.cy="logout",W.className="dropdown-content",Q.className="dropdown-menu",L.className="dropdown is-hoverable is-right",V.className="level-item",setStyle(V,"margin-right","-0.5rem"),j.className="level-right",g.id="header",g.className=pe="level is-mobile "+(t.scrollTop>30?"has-content-under":""),_e.className="modal-background",we.className="subtitle is-4",Te.className="is-small",addListener(Pe,"click",Ge),Pe.className="button is-info is-pulled-right",Ae.className="control",Se.className="field is-grouped is-grouped-right",ye.className="box",ve.className="modal-content",ge.className=Re="modal "+(t.app_state.show_duplicate_login_modal?"is-active":""),he.id="modals",l.id="mainContent",l.className=je=(t.$update_ready?"is-update-ready":"")+" "+(t.app_state.show_sidebar?"is-sidebar-showing":""),a.id="mainApp"},m(e,t){insert(e,a,t),append(a,s),append(s,n),append(s,r),append(r,i),append(a,c),append(a,l),append(l,p),append(p,u),append(p,m),Ie&&Ie.m(p,null),append(l,h),append(l,g),append(g,_),append(_,f),append(f,v),append(v,y),append(v,w),append(v,b),append(v,N),append(v,E),append(f,x),append(f,T),append(T,k),append(T,S),append(T,A),append(A,P),append(g,R),append(g,j),append(j,V),append(V,L),append(L,M),append(M,I),append(I,O),Fe&&Fe.m(O,null),append(I,D),append(I,F),append(F,C),append(C,H),append(C,K),append(C,B),append(F,U),append(F,z),append(z,G),append(I,Y),append(I,J),Ce._mount(J,null),append(L,q),append(L,Q),append(Q,W),append(W,X),He._mount(X,null),append(X,Z),append(X,ee),append(W,te),append(W,ae),Ke._mount(ae,null),append(ae,se),append(ae,ne),append(W,re),append(W,ie),append(W,oe),append(W,de),Be._mount(de,null),append(de,ce),append(de,le),append(l,ue),ze._mount(l,null),append(l,me),append(l,he),append(he,ge),append(ge,_e),append(ge,fe),append(ge,ve),append(ve,ye),append(ye,we),append(ye,be),append(ye,Ne),append(ye,Ee),append(ye,$e),append(ye,xe),append(ye,Te),append(ye,ke),append(ye,Se),append(Se,Ae),append(Ae,Pe),insert(e,Ve,t),Ye._mount(e,t)},p(t,a){t.$update_ready&&o!==(o="button is-small is-light "+(a.$update_ready?"is-pulsing":""))&&(r.className=o),t.$update_ready&&d!==(d=a.$update_ready?"is-update-ready":"")&&(s.className=d),a.$is_loading?Ie&&(Ie.d(1),Ie=null):Ie||((Ie=create_if_block_1(e,a)).c(),Ie.m(p,null)),t.app_state&&$!==($="button navbar-burger\r\n          is-hidden-tablet is-hidden-desktop is-hidden-widescreen is-hidden-fullhd "+(a.app_state.show_sidebar?"is-active":""))&&(v.className=$),t.$ENV_MARKER&&setData(P,a.$ENV_MARKER),a.$user&&a.$user.avatar?Fe?Fe.p(t,a):((Fe=create_if_block$2(e,a)).c(),Fe.m(O,null)):Fe&&(Fe.d(1),Fe=null),t.$user&&Le!==(Le=a.$user&&a.$user.name)&&setData(H,Le),t.$user&&Me!==(Me=a.$user&&a.$user.surname)&&setData(B,Me),t.userRoleName&&setData(G,a.userRoleName),t.scrollTop&&pe!==(pe="level is-mobile "+(a.scrollTop>30?"has-content-under":""))&&(g.className=pe),t.app_state&&Re!==(Re="modal "+(a.app_state.show_duplicate_login_modal?"is-active":""))&&(ge.className=Re),(t.$update_ready||t.app_state)&&je!==(je=(a.$update_ready?"is-update-ready":"")+" "+(a.app_state.show_sidebar?"is-sidebar-showing":""))&&(l.className=je)},d(e){e&&detachNode(a),Ie&&Ie.d(),removeListener(p,"scroll",Oe),removeListener(v,"click",De),Fe&&Fe.d(),Ce.destroy(),He.destroy(),Ke.destroy(),Be.destroy(),removeListener(de,"click",Ue),ze.destroy(),removeListener(Pe,"click",Ge),e&&detachNode(Ve),Ye.destroy(e)}}}function create_if_block_1(e,t){var a=new RouteHandler({root:e.root,store:e.store});return a.on("updateLoggedIn",function(t){e.fire("updateLoggedIn",t)}),a.on("hideSidebar",function(t){e.fire("hideSidebar",t)}),{c(){a._fragment.c()},m(e,t){a._mount(e,t)},d(e){a.destroy(e)}}}function create_if_block$2(e,t){var a,s,n;return{c(){a=createElement("figure"),(s=createElement("img")).alt="",s.src=n=t.$user&&t.$user.avatar,a.className="image is-32x32"},m(e,t){insert(e,a,t),append(a,s)},p(e,t){e.$user&&n!==(n=t.$user&&t.$user.avatar)&&(s.src=n)},d(e){e&&detachNode(a)}}}function App(e){init(this,e),this._state=assign(assign(this.store._init(["user","update_ready","is_loading","ENV_MARKER"]),data$5()),e.data),this.store._add(this,["user","update_ready","is_loading","ENV_MARKER"]),this._recompute({$user:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$6(this,this._state),this.root._oncreate.push(()=>{oncreate$5.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function Store(e,t){this._handlers={},this._dependents=[],this._computed=blankObject(),this._sortedComputedProperties=[],this._state=assign({},e),this._differs=t&&t.immutable?_differsImmutable:_differs}assign(App.prototype,proto),assign(App.prototype,methods$3),App.prototype._recompute=function(e,t){e.$user&&this._differs(t.userRoleName,t.userRoleName=userRoleName(t))&&(e.userRoleName=!0)},assign(Store.prototype,{_add(e,t){this._dependents.push({component:e,props:t})},_init(e){const t={};for(let a=0;a<e.length;a+=1){const s=e[a];t["$"+s]=this._state[s]}return t},_remove(e){let t=this._dependents.length;for(;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_set(e,t){const a=this._state;this._state=assign(assign({},a),e);for(let e=0;e<this._sortedComputedProperties.length;e+=1)this._sortedComputedProperties[e].update(this._state,t);this.fire("state",{changed:t,previous:a,current:this._state}),this._dependents.filter(e=>{const a={};let s=!1;for(let n=0;n<e.props.length;n+=1){const r=e.props[n];r in t&&(a["$"+r]=this._state[r],s=!0)}if(s)return e.component._stage(a),!0}).forEach(e=>{e.component.set({})}),this.fire("update",{changed:t,previous:a,current:this._state})},_sortComputedProperties(){const e=this._computed,t=this._sortedComputedProperties=[],a=blankObject();let s;function n(r){const i=e[r];i&&(i.deps.forEach(e=>{if(e===s)throw new Error(`Cyclical dependency detected between ${e} <-> ${r}`);n(e)}),a[r]||(a[r]=!0,t.push(i)))}for(const e in this._computed)n(s=e)},compute(e,t,a){let s;const n={deps:t,update:(n,r,i)=>{const o=t.map(e=>(e in r&&(i=!0),n[e]));if(i){const t=a.apply(null,o);this._differs(t,s)&&(s=t,r[e]=!0,n[e]=s)}}};this._computed[e]=n,this._sortComputedProperties();const r=assign({},this._state),i={};n.update(r,i,!0),this._set(r,i)},fire:fire,get:get,on:on,set(e){const t=this._state,a=this._changed={};let s=!1;for(const n in e){if(this._computed[n])throw new Error(`'${n}' is a read-only computed property`);this._differs(e[n],t[n])&&(a[n]=s=!0)}s&&this._set(e,a)}});class OptigenStore extends Store{}const store=new OptigenStore({ENV_MARKER:K_ENV==K_ENV_PROD?"":K_ENV,is_loading:!0,is_logged_in:!1,user:{name:"",surname:"",email:"",avatar:"",should_change_password:""},role:null,key:null,mainSections:{},nav:{activeTab:"Home",activeView:"home",params:{}},update_ready:!1,settings:{transition:!0}});var store2=createCommonjsModule(function(e){var t,a,s,n;t=commonjsGlobal,a=commonjsGlobal&&commonjsGlobal.define,s={version:"2.12.0",areas:{},apis:{},inherit:function(e,t){for(var a in e)t.hasOwnProperty(a)||Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a));return t},stringify:function(e){return void 0===e||"function"==typeof e?e+"":JSON.stringify(e)},parse:function(e,t){try{return JSON.parse(e,t||s.revive)}catch(t){return e}},fn:function(e,t){for(var a in s.storeAPI[e]=t,s.apis)s.apis[a][e]=t},get:function(e,t){return e.getItem(t)},set:function(e,t,a){e.setItem(t,a)},remove:function(e,t){e.removeItem(t)},key:function(e,t){return e.key(t)},length:function(e){return e.length},clear:function(e){e.clear()},Store:function(e,t,a){var n=s.inherit(s.storeAPI,function(e,t,a){return 0===arguments.length?n.getAll():"function"==typeof t?n.transact(e,t,a):void 0!==t?n.set(e,t,a):"string"==typeof e||"number"==typeof e?n.get(e):"function"==typeof e?n.each(e):e?n.setAll(e,t):n.clear()});n._id=e;try{t.setItem("__store2_test","ok"),n._area=t,t.removeItem("__store2_test")}catch(e){n._area=s.storage("fake")}return n._ns=a||"",s.areas[e]||(s.areas[e]=n._area),s.apis[n._ns+n._id]||(s.apis[n._ns+n._id]=n),n},storeAPI:{area:function(e,t){var a=this[e];return a&&a.area||(a=s.Store(e,t,this._ns),this[e]||(this[e]=a)),a},namespace:function(e,t){if(!e)return this._ns?this._ns.substring(0,this._ns.length-1):"";var a=e,n=this[a];if(!(n&&n.namespace||(n=s.Store(this._id,this._area,this._ns+a+"."),this[a]||(this[a]=n),t)))for(var r in s.areas)n.area(r,s.areas[r]);return n},isFake:function(){return"fake"===this._area.name},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(e){return this._area.has?this._area.has(this._in(e)):!!(this._in(e)in this._area)},size:function(){return this.keys().length},each:function(e,t){for(var a=0,n=s.length(this._area);a<n;a++){var r=this._out(s.key(this._area,a));if(void 0!==r&&!1===e.call(this,r,this.get(r),t))break;n>s.length(this._area)&&(n--,a--)}return t||this},keys:function(e){return this.each(function(e,t,a){a.push(e)},e||[])},get:function(e,t){var a,n=s.get(this._area,this._in(e));return"function"==typeof t&&(a=t,t=null),null!==n?s.parse(n,a):null!=t?t:n},getAll:function(e){return this.each(function(e,t,a){a[e]=t},e||{})},transact:function(e,t,a){var s=this.get(e,a),n=t(s);return this.set(e,void 0===n?s:n),this},set:function(e,t,a){var n=this.get(e);return null!=n&&!1===a?t:s.set(this._area,this._in(e),s.stringify(t),a)||n},setAll:function(e,t){var a,s;for(var n in e)s=e[n],this.set(n,s,t)!==s&&(a=!0);return a},add:function(e,t){var a=this.get(e);if(a instanceof Array)t=a.concat(t);else if(null!==a){var n=typeof a;if(n===typeof t&&"object"===n){for(var r in t)a[r]=t[r];t=a}else t=a+t}return s.set(this._area,this._in(e),s.stringify(t)),t},remove:function(e,t){var a=this.get(e,t);return s.remove(this._area,this._in(e)),a},clear:function(){return this._ns?this.each(function(e){s.remove(this._area,this._in(e))},1):s.clear(this._area),this},clearAll:function(){var e=this._area;for(var t in s.areas)s.areas.hasOwnProperty(t)&&(this._area=s.areas[t],this.clear());return this._area=e,this},_in:function(e){return"string"!=typeof e&&(e=s.stringify(e)),this._ns?this._ns+e:e},_out:function(e){return this._ns?e&&0===e.indexOf(this._ns)?e.substring(this._ns.length):void 0:e}},storage:function(e){return s.inherit(s.storageAPI,{items:{},name:e})},storageAPI:{length:0,has:function(e){return this.items.hasOwnProperty(e)},key:function(e){var t=0;for(var a in this.items)if(this.has(a)&&e===t++)return a},setItem:function(e,t){this.has(e)||this.length++,this.items[e]=t},removeItem:function(e){this.has(e)&&(delete this.items[e],this.length--)},getItem:function(e){return this.has(e)?this.items[e]:null},clear:function(){for(var e in this.items)this.removeItem(e)}}},(n=s.Store("local",function(){try{return localStorage}catch(e){}}())).local=n,n._=s,n.area("session",function(){try{return sessionStorage}catch(e){}}()),n.area("page",s.storage("page")),"function"==typeof a&&void 0!==a.amd?a("store2",[],function(){return n}):e.exports?e.exports=n:(t.store&&(s.conflict=t.store),t.store=n)}),store$1=function(){return this.store=store2.namespace("eyelight_admin"),this.store},DB=new store$1,currentState=function(){var e=store.get(),t=null;this.init=function(a){t=a,function(){document.activeElement&&document.activeElement.blur();var a=DB.get("state");void 0!==a&&a?e=a:DB.set("state",e);Net.setKey(e.key),Net.bind("httpError",function(e){409==e&&t.fire("duplicateLogin"),401==e&&t.fire("noAccess")}),e.online=navigator.onLine,e.is_logged_in&&(Access.isAllowed(e.role)||(e.is_logged_in=!1,e.user=null,e.role=null,e.key=null,DB.set("state",e)));if(store.set(e),window.addEventListener("offline",function(e){store.set({online:!1})}),window.addEventListener("online",function(e){store.set({online:!0})}),K_ENV!=K_ENV_DEV)var s=window.setInterval(function(){Net.ajax({url:"./version.json?t="+(new Date).getTime(),method:"GET"}).then(function(e){var a="1.0.041afa9a".replace(/\s?\[dev\]/,""),n=(e.response.version+e.response.build).replace(/\s?\[dev\]/,"");a!=n&&(t.fire("updateReady"),window.clearInterval(s))}).catch(function(){})},3e5);e.is_logged_in?(store.set({mainSections:Access.mainSections(e.role)}),setTimeout(function(){store.set({is_loading:!1})},500)):setTimeout(function(){store.set({is_loading:!1})},500)}()},this.updateState=function(t){e=Object.assign(e,t),DB.set("state",e)},this.authenticate=function(e,t,a){return new Promise(function(s,n){Net.authenticate(e,t,a).then(function(e){Access.isAllowed(e.role)?(store.set({mainSections:Access.mainSections(e.role)}),Net.setKey(e.key),s(e)):n({valid:!1,response:{userMessage:"You do not have sufficient access permissions"}})},function(e){n(e)})})},this.deauthenticate=function(){Net.setKey(null)}},State=new currentState,app=new App({store:store,target:document.getElementById("app")});app.on("toggleSidebar",function(){var{app_state:e}=app.get();e.show_sidebar=!e.show_sidebar,app.set({app_state:e})}),app.on("hideSidebar",function(){var{app_state:e}=app.get();e.show_sidebar=!1,app.set({app_state:e})}),app.on("duplicateLogin",function(){var{app_state:e}=app.get();e.show_duplicate_login_modal=!0,app.set({app_state:e})}),app.on("updateReady",function(){store.set({update_ready:!0})}),app.on("updateLoggedIn",function(e){var{user:t}=store.get();t.name=e.name,t.surname=e.surname,t.email=e.email,t.avatar=e.avatar,t.should_change_password=e.should_change_password,store.set({user:t})}),app.on("validatelogin",function(e){var{username:t,password:a}=e.get();State.authenticate(t,a,"SA").then(function(t){if(t.valid){e.valid();var a={user:t,key:t.key,role:t.role,is_logged_in:!0};store.set(a);var s=window.location.hash;return Router.navigate("nf"),void setTimeout(function(){Router.navigate(s.substring(1))},10)}e.invalid()},function(t){e.invalid()})}),app.on("logout",function(){State.deauthenticate();var{app_state:e}=app.get();e.show_duplicate_login_modal=!1,store.set({is_logged_in:!1,user:{name:"",surname:"",email:"",username:"",avatar:"",should_change_password:""},role:null,key:null}),this.set({app_state:e})}),store.on("state",function({changed:e,current:t,previous:a}){var s={};["is_logged_in","user","key","role"].forEach(a=>{e[a]&&(s[a]=t[a])}),State.updateState(s)}),State.init(app);export default app;
//# sourceMappingURL=bundle.js.map
