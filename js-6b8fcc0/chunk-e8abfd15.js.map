{"version":3,"file":"chunk-e8abfd15.js","sources":["../../../src/components/views/helpers/Timeline.html"],"sourcesContent":["<p class=\"title is-5\">Remedy History\r\n  {#if !is_static}\r\n  <span class=\"is-pulled-right\">\r\n    <button class=\"button is-primary\" type=\"button\" on:click=\"set({add_remedy: !add_remedy})\">{add_remedy ? 'Cancel' : 'Add More'}</button>\r\n  </span>\r\n  {/if}\r\n</p>\r\n\r\n<div>\r\n  {#if history != null && typeof history.length != 'undefined' && history.length > 0}\r\n    <ul class=\"timeline\">\r\n      {#each history as item}\r\n        <li>\r\n          <span class=\"description\"><strong>{item.date}</strong>\r\n            {#if item.date == niceDate(today) && !is_static }\r\n            <span class=\"is-pulled-right\">\r\n              <button type=\"button\" class=\"button is-small\" on:click=\"edit(item.remedies)\" >\r\n                <span class=\"icon is-small\"><i class=\"fa fa-pencil\"></i></span>\r\n              </button>\r\n            </span>\r\n            {/if}\r\n          </span>\r\n          <span class=\"description\">\r\n\r\n            <table class=\"table has-background-warning-light\">\r\n              {#each item.remedies as {remedy, power, taking_rule}, i}\r\n                <tr>\r\n                  <td>{remedy}</td>\r\n                  <td>{power}</td>\r\n                  <td>{taking_rule}</td>\r\n                  <td></td>\r\n                  <td></td>\r\n                </tr>\r\n              {/each}\r\n            </table>\r\n\r\n            <br>\r\n          </span>\r\n        </li>\r\n      {/each}\r\n    </ul>\r\n    {#if hasMoreItems}\r\n    <div class=\"columns\">\r\n      <div class=\"column\">\r\n        <hr>\r\n        <button class=\"button is-info is-small is-fullwidth\" type=\"button\" on:click=\"showAll()\"><Icon icon=\"chevron-down\" /> <span>Show <strong>{history.length - visible}</strong> more items</span></button>\r\n      </div>\r\n    </div>\r\n    {/if}\r\n  {/if}\r\n</div>\r\n\r\n<script>\r\n\r\nimport { Icon, Panel } from '@kws3/helpers';\r\nimport fuzzysearch from 'fuzzysearch';\r\nimport {nl2br} from '../../../utils/templateHelpers.js';\r\nimport niceDate from '../../../utils/niceDate.js';\r\n\r\nexport default {\r\n  components:{\r\n    Icon, Panel\r\n  },\r\n  data(){\r\n    return {\r\n      history: [],\r\n      visible: 5,\r\n      showAll: false,\r\n      filter: '',\r\n      add_remedy: false,\r\n      is_static: false,\r\n    }\r\n  },\r\n  helpers:{\r\n    nl2br,\r\n    niceDate\r\n  },\r\n  computed:{\r\n    today: ({history}) => new Date(),\r\n    history: ({data}) => {\r\n        if(data.treatments){\r\n          let values = data.treatments;\r\n          // this gives an object with dates as keys\r\n          const groups = values.reduce((groups, remedy) => {\r\n            const date = niceDate(remedy.created);\r\n\r\n            if (!groups[date]) {\r\n              groups[date] = [];\r\n            }\r\n            groups[date].push(remedy);\r\n            return groups;\r\n          }, {});\r\n\r\n          // Edit: to add it in the array format instead\r\n          const groupArrays = Object.keys(groups).map((date) => {\r\n            return {\r\n              date,\r\n              remedies: groups[date]\r\n            };\r\n          });\r\n\r\n          return groupArrays\r\n        }\r\n        return []\r\n      },\r\n    // _history({history, visible, showAll, filter, has_filter}){\r\n    //   var _history = (history || []).slice();\r\n    //   if(has_filter)\r\n    //   {\r\n    //     _history = _history.filter(item =>{\r\n    //       if(fuzzysearch(filter, item.description.toLowerCase()))\r\n    //       {\r\n    //         return item;\r\n    //       }\r\n    //     });\r\n    //   }\r\n    //   return ((!showAll && !has_filter) && (_history.length > (visible + 1))) ? _history.slice(0, visible) : _history;\r\n    // },\r\n    // hasMoreItems({history, visible, showAll, has_filter}){\r\n    //   return (((!showAll && !has_filter) && (history.length - (visible + 1))) > 0);\r\n    // },\r\n    // has_filter: ({filter}) => filter && filter.trim() != ''\r\n  },\r\n  oncreate(){\r\n    this.on('resetSearch', () => {\r\n      this.set({\r\n        filter: ''\r\n      });\r\n    });\r\n  },\r\n  methods:{\r\n    showAll(){\r\n      this.set({showAll: true});\r\n    },\r\n    edit(items){\r\n      this.fire('editPrescription', items)\r\n    }\r\n  }\r\n}\r\n</script>"],"names":["history","Date","data","treatments","groups","reduce","remedy","date","niceDate","created","push","Object","keys","map","remedies","visible","showAll","filter","add_remedy","is_static","[object Object]","this","set","items","fire","on","edit","item","length","hasMoreItems","power","taking_rule","today"],"mappings":"uYA2DA,gBAmBYA,QAACA,WAAa,IAAIC,uBAChBC,KAACA,IACP,GAAGA,EAAKC,WAAW,CAGjB,MAAMC,EAFOF,EAAKC,WAEIE,OAAO,CAACD,EAAQE,KACpC,MAAMC,EAAOC,SAASF,EAAOG,SAM7B,OAJKL,EAAOG,KACVH,EAAOG,GAAQ,IAEjBH,EAAOG,GAAMG,KAAKJ,GACXF,GACN,IAUH,OAPoBO,OAAOC,KAAKR,GAAQS,IAAKN,IACpC,CACLA,KAAAA,EACAO,SAAUV,EAAOG,MAMvB,MAAO,mBAvCX,MAAO,CACLP,QAAS,GACTe,QAAS,EACTC,SAAS,EACTC,OAAQ,GACRC,YAAY,EACZC,WAAW,eA4DP,CACNC,UACEC,KAAKC,IAAI,CAACN,SAAS,KAErBI,KAAKG,GACHF,KAAKG,KAAK,mBAAoBD,yBAXhCF,KAAKI,GAAG,cAAe,KACrBJ,KAAKC,IAAI,CACPL,OAAQ,2NA9GsDS,OAAKC,KAAKb,6IAfxEK,oCAQU,QAAXnB,cAA4C,MAAlBA,QAAQ4B,UAAyB5B,QAAQ4B,OAAS,8RAR3ET,qFAQU,QAAXnB,cAA4C,MAAlBA,QAAQ4B,UAAyB5B,QAAQ4B,OAAS,qMANYV,WAAa,SAAW,2BAAzDI,IAAI,CAACJ,cAAaA,kRAAeA,WAAa,SAAW,+HAQ1GlB,qBAAL4B,sEA8Ba,+UA9BR5B,wBAAL4B,8JAAAA,SA8BCC,2rBAdcvB,WACAwB,UACAC,yiBAFAzB,0CACAwB,yCACAC,oHAhBsBJ,KAAKpB,SACjCoB,KAAKpB,MAAQC,WAASwB,WAAWb,sCAW7BQ,KAAKb,sBAAVc,+rBAZ6BD,KAAKpB,sBACjCoB,KAAKpB,MAAQC,WAASwB,UAAWb,oGAW7BQ,KAAKb,yBAAVc,kKAAAA,yHAoBiI5B,QAAQ4B,SAASb,2FAA7EC,qnBAA4DhB,QAAQ4B,SAASb"}