var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{a as append,b as assign,c as assignTrue,u as createComment,d as createElement,e as createFragment,f as createText,v as destroyEach,g as detachNode,h as flush,i as init,j as insert,l as proto,m as removeFromStore,C as setAttribute,w as setData,n as Icon,x as Panel,o as Message,q as ViewScaffold,r as PageTitle,y as Notification}from"./chunk-b74ece54.js";import{a as Router}from"./chunk-186691d9.js";import{c as ConfirmButton,a as SubmitButton}from"./chunk-a0c19dba.js";import{a as Model}from"./chunk-107a8f39.js";import{a as TreatmentModel}from"./chunk-7807e75e.js";import{c as SlidingPaneSet,d as SlidingPane}from"./chunk-5c7d6046.js";import{a as LabsTabs,b as Search}from"./Search-4987ad7f.js";import{a as PatientDetails}from"./chunk-43f78b8a.js";import{a as Timeline}from"./chunk-e8abfd15.js";import"./chunk-59e2ee62.js";import"./chunk-da8d06c7.js";import"./chunk-fd604495.js";import"./chunk-6760c5c7.js";import"./chunk-3b9a27cc.js";import"./chunk-2e16b4c0.js";function entityId({$nav:e}){return e&&e.params[0]}function data(){return{is_loading:!1,is_error:!1,error_message:"",data:{},meta:{},omitted_field:["id","name","created","modified","deleted","patient","treatments"],tracker:{saving:!1,saved:!1,error:!1},page:{title:"View Case History",subtitle:"Case History details",icon:"building-o",icon_badge:"pencil"}}}var methods={load(){var{entityId:e}=this.get();this.set({is_loading:!0,is_error:!1}),Model&&Model.getOne(e).then(e=>{this.set({is_loading:!1,meta:e._meta,data:e.response})}).catch(e=>{var t="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(t=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:t})})},deleteHistory(e){e&&e.doing(),Model.delete(this.get().entityId).then(t=>{e.done(),Router.navigate("history")}).catch(()=>{e.error()})}};function oncreate(){var{entityId:e}=this.get();this.load()}function get_each_context(e,t,a){const r=Object.create(e);return r.key=t[a][0],r.value=t[a][1],r.i=a,r}function create_main_fragment(e,t){var a,r,s,o,i,n,d,c,_,l=new ConfirmButton({root:e.root,store:e.store,data:{text:"Delete History",color:"danger",icon:"trash",icon_only:!1}});l.on("do",function(t){e.deleteHistory(t)});for(var m=t.data.patient&&create_if_block_2(e,t),g=t.data.treatments&&create_if_block_1(e,t),u=t.Object.entries(t.data),h=[],p=0;p<u.length;p+=1)h[p]=create_each_block(e,get_each_context(t,u,p));var f=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{title:"Records",color:"info"}}),v=new Panel({root:e.root,store:e.store,slots:{default:createFragment(),toolbar:createFragment()},data:{title:"Patient symptoms",has_toolbar:!0}}),b={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message},y=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:b});return{c(){a=createElement("div"),r=createElement("div"),l._fragment.c(),s=createText("\r\n\r\n    "),o=createElement("div"),i=createElement("div"),m&&m.c(),n=createText("\r\n\r\n        "),g&&g.c(),d=createText("\r\n      "),c=createElement("div");for(var e=0;e<h.length;e+=1)h[e].c();_=createComment(),f._fragment.c(),v._fragment.c(),y._fragment.c(),setAttribute(r,"slot","toolbar"),i.className="column is-5",c.className="column is-7",o.className="columns",a.className="page-content"},m(e,t){insert(e,a,t),append(v._slotted.toolbar,r),l._mount(r,null),append(v._slotted.default,s),append(v._slotted.default,o),append(o,i),m&&m.m(i,null),append(i,n),g&&g.m(i,null),append(o,d),append(o,c);for(var u=0;u<h.length;u+=1)h[u].m(f._slotted.default,null);append(f._slotted.default,_),f._mount(c,null),v._mount(y._slotted.default,null),y._mount(a,null)},p(t,a){if(a.data.patient?m?m.p(t,a):((m=create_if_block_2(e,a)).c(),m.m(i,n)):m&&(m.d(1),m=null),a.data.treatments?g?g.p(t,a):((g=create_if_block_1(e,a)).c(),g.m(i,null)):g&&(g.d(1),g=null),t.Object||t.data||t.omitted_field){u=a.Object.entries(a.data);for(var r=0;r<u.length;r+=1){const s=get_each_context(a,u,r);h[r]?h[r].p(t,s):(h[r]=create_each_block(e,s),h[r].c(),h[r].m(_.parentNode,_))}for(;r<h.length;r+=1)h[r].d(1);h.length=u.length}var s={};t.is_loading&&(s.is_loading=a.is_loading),t.is_error&&(s.is_error=a.is_error),t.error_message&&(s.error_message=a.error_message),y._set(s)},d(e){e&&detachNode(a),l.destroy(),m&&m.d(),g&&g.d(),destroyEach(h,e),f.destroy(),v.destroy(),y.destroy()}}}function create_if_block_2(e,t){var a,r,s={data:t.data.patient},o=new PatientDetails({root:e.root,store:e.store,data:s}),i=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"info"}});return{c(){(a=createElement("p")).textContent="Patient Details",r=createText("\r\n            "),o._fragment.c(),i._fragment.c(),a.className="title is-5"},m(e,t){append(i._slotted.default,a),append(i._slotted.default,r),o._mount(i._slotted.default,null),i._mount(e,t)},p(e,t){var a={};e.data&&(a.data=t.data.patient),o._set(a)},d(e){o.destroy(),i.destroy(e)}}}function create_if_block_1(e,t){var a={},r={is_static:"true"};void 0!==t.data&&(r.data=t.data,a.data=!0);var s=new Timeline({root:e.root,store:e.store,data:r,_bind(t,r){var s={};!a.data&&t.data&&(s.data=r.data),e._set(s),a={}}});e.root._beforecreate.push(()=>{s._bind({data:1},s.get())});var o=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"info"}});return{c(){s._fragment.c(),o._fragment.c()},m(e,t){s._mount(o._slotted.default,null),o._mount(e,t)},p(e,r){t=r;var o={};!a.data&&e.data&&(o.data=t.data,a.data=void 0!==t.data),s._set(o),a={}},d(e){s.destroy(),o.destroy(e)}}}function create_if_block(e,t){var a,r,s,o,i,n,d,c=t.key,_=t.value;return{c(){a=createElement("p"),r=createElement("span"),s=createText(c),o=createText(": "),i=createText(_),n=createText(" "),d=createElement("br"),r.className="has-text-weight-bold is-size-4",a.className="is-size-5"},m(e,t){insert(e,a,t),append(a,r),append(r,s),append(a,o),append(a,i),insert(e,n,t),insert(e,d,t)},p(e,t){(e.Object||e.data)&&c!==(c=t.key)&&setData(s,c),(e.Object||e.data)&&_!==(_=t.value)&&setData(i,_)},d(e){e&&(detachNode(a),detachNode(n),detachNode(d))}}}function create_each_block(e,t){var a,r=t.value&&!t.omitted_field.includes(t.key)&&create_if_block(e,t);return{c(){r&&r.c(),a=createComment()},m(e,t){r&&r.m(e,t),insert(e,a,t)},p(t,s){s.value&&!s.omitted_field.includes(s.key)?r?r.p(t,s):((r=create_if_block(e,s)).c(),r.m(a.parentNode,a)):r&&(r.d(1),r=null)},d(e){r&&r.d(e),e&&detachNode(a)}}}function ViewHistoryStatic(e){init(this,e),this._state=assign(assign(assign({Object:Object},this.store._init(["nav"])),data()),e.data),this.store._add(this,["nav"]),this._recompute({$nav:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function entityId$1({$nav:e}){return e&&e.params[0]}function data$1(){return{is_loading:!1,is_error:!1,error_message:"",pane_height:500,data:{},meta:{},tracker:{saving:!1,saved:!1,error:!1},page:{title:"View Case History",subtitle:"Case History details",icon:"building-o",icon_badge:"pencil"},active_tab:"static_view",tabs:[{icon:"info-circle",name:"static_view",title:"Static"},{icon:"pencil",name:"edit_view",title:"Edit Case History"}]}}assign(ViewHistoryStatic.prototype,proto),assign(ViewHistoryStatic.prototype,methods),ViewHistoryStatic.prototype._recompute=function(e,t){e.$nav&&this._differs(t.entityId,t.entityId=entityId(t))&&(e.entityId=!0)};var methods$1={load(){var{entityId:e}=this.get();this.set({is_loading:!0,is_error:!1}),Model&&Model.getOne(e).then(e=>{this.set({is_loading:!1,meta:e._meta,data:e.response})}).catch(e=>{var t="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(t=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:t})})},save(){var{data:e,entityId:t,tracker:a}=this.get();this.set({tracker:{saving:!0,saved:!1,error:!1}}),Model.save(t,e).then(e=>{this.set({data:e.response,tracker:{saving:!1,saved:!0,error:!1}}),setTimeout(()=>{a.saved=!1,this.set({tracker:a})},1500)}).catch(e=>{console.log(e),this.set({error_message:"There was an error updating history"}),this.set({tracker:{saving:!1,saved:!1,error:!0}}),setTimeout(()=>{this.set({tracker:{error:!1}})},1500)})},saveTreatment(e,t){e.preventDefault();let{data:a,entityId:r}=this.get(),s={prescribe:{id:r,patient:a.patient.id},data:t};this.set({tracker:{saving:!0,saved:!1,error:!1}}),TreatmentModel&&TreatmentModel.createWithCase(s).then(e=>{this.set({tracker:{saving:!1,saved:!0,error:!1}}),setTimeout(()=>{this.set({tracker:{saved:!1}})},1500)}).catch(e=>{console.log(e)})}};function oncreate$1(){this.on("heightChange",({height:e})=>{this.set({pane_height:e})}),this.on("saveTreatment",e=>{this.saveTreatment(event,e)}),this.on("state",({changed:e,current:t,previous:a})=>{}),this.load()}function create_main_fragment$1(e,t){var a,r,s,o,i,n,d,c,_={},l=new Icon({root:e.root,store:e.store,data:{icon:"long-arrow-left",size:"small"}}),m={page:t.page},g=new PageTitle({root:e.root,store:e.store,slots:{default:createFragment()},data:m}),u={tabs:t.tabs};void 0!==t.active_tab&&(u.active_tab=t.active_tab,_.active_tab=!0);var h=new LabsTabs({root:e.root,store:e.store,data:u,_bind(t,a){var r={};!_.active_tab&&t.active_tab&&(r.active_tab=a.active_tab),e._set(r),_={}}});e.root._beforecreate.push(()=>{h._bind({active_tab:1},h.get())});var p="static_view"==t.active_tab&&create_if_block_1$1(e,t),f="edit_view"==t.active_tab&&create_if_block$1(e,t),v={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message,class:"has-fullpage-tabs has-multilevel-tabs"},b=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:v});return{c(){a=createElement("div"),r=createElement("a"),l._fragment.c(),s=createText("\r\n      "),(o=createElement("span")).textContent="Back to All Histories",g._fragment.c(),i=createText("\r\n\r\n  "),h._fragment.c(),n=createText("\r\n\r\n    \r\n        "),p&&p.c(),d=createText("\r\n      \r\n        "),f&&f.c(),c=createComment(),b._fragment.c(),r.className="button is-info is-pulled-right",r.href="#history",a.className="page-content"},m(e,t){insert(e,a,t),append(g._slotted.default,r),l._mount(r,null),append(r,s),append(r,o),g._mount(a,null),append(a,i),h._mount(b._slotted.default,null),append(b._slotted.default,n),p&&p.m(b._slotted.default,null),append(b._slotted.default,d),f&&f.m(b._slotted.default,null),append(b._slotted.default,c),b._mount(a,null)},p(a,r){t=r;var s={};a.page&&(s.page=t.page),g._set(s);var o={};a.tabs&&(o.tabs=t.tabs),!_.active_tab&&a.active_tab&&(o.active_tab=t.active_tab,_.active_tab=void 0!==t.active_tab),h._set(o),_={},"static_view"==t.active_tab?p?p.p(a,t):((p=create_if_block_1$1(e,t)).c(),p.m(d.parentNode,d)):p&&(p.d(1),p=null),"edit_view"==t.active_tab?f?f.p(a,t):((f=create_if_block$1(e,t)).c(),f.m(c.parentNode,c)):f&&(f.d(1),f=null);var i={};a.is_loading&&(i.is_loading=t.is_loading),a.is_error&&(i.is_error=t.is_error),a.error_message&&(i.error_message=t.error_message),b._set(i)},d(e){e&&detachNode(a),l.destroy(),g.destroy(),h.destroy(),p&&p.d(),f&&f.d(),b.destroy()}}}function create_if_block_1$1(e,t){var a={},r={};void 0!==t.is_error&&(r.is_error=t.is_error,a.is_error=!0),void 0!==t.error_message&&(r.error_message=t.error_message,a.error_message=!0);var s=new ViewHistoryStatic({root:e.root,store:e.store,data:r,_bind(t,r){var s={};!a.is_error&&t.is_error&&(s.is_error=r.is_error),!a.error_message&&t.error_message&&(s.error_message=r.error_message),e._set(s),a={}}});return e.root._beforecreate.push(()=>{s._bind({is_error:1,error_message:1},s.get())}),{c(){s._fragment.c()},m(e,t){s._mount(e,t)},p(e,r){t=r;var o={};!a.is_error&&e.is_error&&(o.is_error=t.is_error,a.is_error=void 0!==t.is_error),!a.error_message&&e.error_message&&(o.error_message=t.error_message,a.error_message=void 0!==t.error_message),s._set(o),a={}},d(e){s.destroy(e)}}}function create_if_block$1(e,t){var a={},r={edit_case:!0};void 0!==t.data&&(r.data=t.data,a.data=!0),void 0!==t.tracker&&(r.tracker=t.tracker,a.tracker=!0);var s=new Search({root:e.root,store:e.store,data:r,_bind(t,r){var s={};!a.data&&t.data&&(s.data=r.data),!a.tracker&&t.tracker&&(s.tracker=r.tracker),e._set(s),a={}}});return e.root._beforecreate.push(()=>{s._bind({data:1,tracker:1},s.get())}),s.on("save",function(t){e.save()}),s.on("saveTreatment",function(t){e.fire("saveTreatment",t)}),{c(){s._fragment.c()},m(e,t){s._mount(e,t)},p(e,r){t=r;var o={};!a.data&&e.data&&(o.data=t.data,a.data=void 0!==t.data),!a.tracker&&e.tracker&&(o.tracker=t.tracker,a.tracker=void 0!==t.tracker),s._set(o),a={}},d(e){s.destroy(e)}}}function ViewHistory(e){init(this,e),this._state=assign(assign(this.store._init(["nav"]),data$1()),e.data),this.store._add(this,["nav"]),this._recompute({$nav:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$1(this,this._state),this.root._oncreate.push(()=>{oncreate$1.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}assign(ViewHistory.prototype,proto),assign(ViewHistory.prototype,methods$1),ViewHistory.prototype._recompute=function(e,t){e.$nav&&this._differs(t.entityId,t.entityId=entityId$1(t))&&(e.entityId=!0)};export default ViewHistory;
//# sourceMappingURL=ViewHistory.js.map
