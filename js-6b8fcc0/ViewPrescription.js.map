{"version":3,"file":"ViewPrescription.js","sources":["../../../src/components/views/prescription/ViewPrescription.html"],"sourcesContent":["<div class=\"page-content\">\r\n  <PageTitle page=\"{page}\">\r\n    <a class=\"button is-info is-pulled-right\" href=\"#prescriptions\">\r\n      <Icon icon=\"long-arrow-left\" size=\"small\" />\r\n      <span>Back to All Prescriptions</span>\r\n    </a>\r\n  </PageTitle>\r\n\r\n  <ViewScaffold {is_loading} {is_error} {error_message}>\r\n\r\n    {#if tracker.error}\r\n    <Notification type=\"danger\"> {error_message} </Notification>\r\n    {/if}\r\n\r\n    <Panel title=\"Prescription Details\" has_toolbar={true} >\r\n      <div slot='toolbar'>\r\n\r\n        <a type=\"button\" class=\"button is-gray\" href=\"/#history/view/{entityId}\" >\r\n          <span class=\"icon is-small\"><i class=\"fa fa-eye\"></i></span>\r\n          <span>\r\n            View case history\r\n          </span>\r\n        </a>\r\n      </div>\r\n\r\n      <div class=\"columns\">\r\n        <div class=\"column\">\r\n        {#if data.patient}\r\n        <p class=\"title is-5\">Patient Details</p>\r\n\r\n        <PatientDetails data={data.patient} />\r\n        {/if}\r\n        </div>\r\n        <div class=\"column\">\r\n          <div class=\"columns\">\r\n            <div class=\"column\">\r\n              <Message color=\"light\" size=\"large\">\r\n\r\n              {#if add_remedy}\r\n                <AddTreatment\r\n                  bind:remedy_names\r\n                  bind:data\r\n                  bind:selected_remedies\r\n                  bind:tracker\r\n                  bind:add_remedy\r\n                  prescribe={true}\r\n                  on:saveTreatment\r\n               />\r\n              {:else}\r\n              <Timeline bind:data on:editPrescription bind:add_remedy />\r\n              {/if}\r\n\r\n            </Message>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    </Panel>\r\n\r\n  </ViewScaffold>\r\n</div>\r\n\r\n<script>\r\n  import Model from '../../../models/histories';\r\n  import Remedies from '../../../models/remedies';\r\n  import TreatmentModel from '../../../models/treatments';\r\n  import {Icon, Notification, Panel, Message} from '@kws3/helpers';\r\n  import { ConfirmButton } from '@kws3/buttons';\r\n  import Router from '../../../services/router';\r\n  import PatientDetails from '../helpers/PatientDetails.html';\r\n  import Timeline from '../helpers/Timeline.html';\r\n  import niceDate from '../../../utils/niceDate.js';\r\n  import AddTreatment from '../search/helpers/Treatment.html';\r\n\r\n  export default {\r\n    components: {\r\n      ViewScaffold: '../../helpers/ViewScaffold.html',\r\n      PageTitle: '../../helpers/PageTitle.html',\r\n      Notification, Message, ConfirmButton,\r\n      Icon, Panel, PatientDetails, Timeline, AddTreatment,\r\n\r\n    },\r\n    helpers: {\r\n      niceDate,\r\n    },\r\n    data() {\r\n      return {\r\n        is_loading: false,\r\n        is_error: false,\r\n        edit_remedies: false,\r\n        error_message: '',\r\n        remedies: {},\r\n        data: {},\r\n        meta: {},\r\n        add_remedy: false,\r\n        tracker: {\r\n          saving: false,\r\n          saved: false,\r\n          error: false,\r\n        },\r\n        page: {\r\n          title: 'View Prescription',\r\n          subtitle: 'Patients prescription details',\r\n          icon: 'building-o',\r\n          icon_badge: 'pencil'\r\n        },\r\n      }\r\n    },\r\n    computed: {\r\n      entityId: ({ $nav }) => $nav && $nav.params[0],\r\n      remedy_names: ({remedies}) => {\r\n        let _names= [];\r\n\r\n        for(let item in remedies){\r\n          let single = remedies[item];\r\n          _names.push(single.name);\r\n        }\r\n        return _names;\r\n      },\r\n    },\r\n    oncreate() {\r\n      var { entityId } = this.get();\r\n\r\n      this.on('saveTreatment', treatments => {\r\n        this.savePrescription(treatments);\r\n      });\r\n\r\n      this.on('editPrescription', remedies => {\r\n        console.log(remedies)\r\n        this.set({\r\n          add_remedy: true,\r\n          edit_remedies: true,\r\n          selected_remedies: remedies\r\n        })\r\n      })\r\n\r\n      this.load();\r\n      this.loadRemedies();\r\n    },\r\n    methods: {\r\n      load() {\r\n        var { entityId } = this.get();\r\n\r\n        this.set({\r\n          is_loading: true,\r\n          is_error: false\r\n        });\r\n\r\n        Model && Model.getOne(entityId)\r\n        .then((r) => {\r\n\r\n          this.set({\r\n            is_loading: false,\r\n            meta: r._meta,\r\n            data: r.response\r\n          });\r\n\r\n        })\r\n        .catch((r) => {\r\n          var user_message = '';\r\n          if (typeof r != 'undefined' && typeof r.response != 'undefined' && typeof r.response.records != 'undefined') {\r\n            user_message = r.response.records.userMessage;\r\n          }\r\n          this.set({\r\n            'is_error': true,\r\n            'is_loading': false,\r\n            'error_message': user_message\r\n          });\r\n        });\r\n      },\r\n      loadRemedies(){\r\n        Remedies.getAll({limit:1000})\r\n        .then( (r) => {\r\n          this.set({ remedies: r.response })\r\n        })\r\n        .catch( (r) => {\r\n          console.log(r)\r\n        })\r\n      },\r\n      savePrescription(treatments) {\r\n        let {data, entityId, edit_remedies} = this.get();\r\n\r\n        let structured = {\r\n          prescribe: {\r\n            id: entityId,\r\n            patient: data.patient.id\r\n          },\r\n          data: treatments,\r\n          edit_remedies\r\n        };\r\n\r\n        this.set({\r\n          tracker: {\r\n            saving: true,\r\n            saved: false,\r\n            error: false\r\n          }\r\n        });\r\n\r\n        TreatmentModel.createWithCase(structured)\r\n        .then( (r) => {\r\n          this.set({\r\n            tracker: {\r\n              saving: false,\r\n              saved: true,\r\n              error: false\r\n            }\r\n          });\r\n\r\n          setTimeout( () => {\r\n            this.set({ tracker: { saved: false }, add_remedy: false });\r\n            this.load();\r\n          }, 1500);\r\n\r\n        })\r\n        .catch( (r) => {\r\n          console.log(r)\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>"],"names":["$nav","params","remedies","_names","item","single","push","name","is_loading","is_error","edit_remedies","error_message","data","meta","add_remedy","tracker","saving","saved","error","page","title","subtitle","icon","icon_badge","[object Object]","entityId","this","get","set","Model","getOne","then","r","_meta","response","catch","user_message","records","userMessage","Remedies","getAll","limit","console","log","treatments","structured","prescribe","id","patient","TreatmentModel","createWithCase","setTimeout","load","on","savePrescription","selected_remedies","loadRemedies","remedy_names"],"mappings":"mzBA2EA,mBAmCiBA,KAAEA,WAAWA,GAAQA,EAAKC,OAAO,0BAC7BC,SAACA,IACd,IAAIC,EAAQ,GAEZ,IAAI,IAAIC,KAAQF,EAAS,CACvB,IAAIG,EAASH,EAASE,GACtBD,EAAOG,KAAKD,EAAOE,MAErB,OAAOJ,kBA/BT,MAAO,CACLK,YAAY,EACZC,UAAU,EACVC,eAAe,EACfC,cAAe,GACfT,SAAU,GACVU,KAAM,GACNC,KAAM,GACNC,YAAY,EACZC,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,GAETC,KAAM,CACJC,MAAO,oBACPC,SAAU,gCACVC,KAAM,aACNC,WAAY,uBAmCT,CACPC,OACE,IAAIC,SAAEA,GAAaC,KAAKC,MAExBD,KAAKE,IAAI,CACPpB,YAAY,EACZC,UAAU,IAGZoB,OAASA,MAAMC,OAAOL,GACrBM,KAAMC,IAELN,KAAKE,IAAI,CACPpB,YAAY,EACZK,KAAMmB,EAAEC,MACRrB,KAAMoB,EAAEE,aAIXC,MAAOH,IACN,IAAII,EAAe,QACH,IAALJ,QAAyC,IAAdA,EAAEE,eAAwD,IAAtBF,EAAEE,SAASG,UACnFD,EAAeJ,EAAEE,SAASG,QAAQC,aAEpCZ,KAAKE,IAAI,CACPnB,UAAY,EACZD,YAAc,EACdG,cAAiByB,OAIvBZ,eACEe,SAASC,OAAO,CAACC,MAAM,MACtBV,KAAOC,IACNN,KAAKE,IAAI,CAAE1B,SAAU8B,EAAEE,aAExBC,MAAQH,IACPU,QAAQC,IAAIX,MAGhBR,iBAAiBoB,GACf,IAAIhC,KAACA,EAAIa,SAAEA,EAAQf,cAAEA,GAAiBgB,KAAKC,MAEvCkB,EAAa,CACfC,UAAW,CACTC,GAAItB,EACJuB,QAASpC,EAAKoC,QAAQD,IAExBnC,KAAMgC,EACNlC,cAAAA,GAGFgB,KAAKE,IAAI,CACPb,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,KAIX+B,eAAeC,eAAeL,GAC7Bd,KAAOC,IACNN,KAAKE,IAAI,CACPb,QAAS,CACPC,QAAQ,EACRC,OAAO,EACPC,OAAO,KAIXiC,WAAY,KACVzB,KAAKE,IAAI,CAAEb,QAAS,CAAEE,OAAO,GAASH,YAAY,IAClDY,KAAK0B,QACJ,QAGJjB,MAAQH,IACPU,QAAQC,IAAIX,2BA/FhB,IAAIP,SAAEA,GAAaC,KAAKC,MAExBD,KAAK2B,GAAG,gBAAiBT,IACvBlB,KAAK4B,iBAAiBV,KAGxBlB,KAAK2B,GAAG,mBAAoBnD,IAC1BwC,QAAQC,IAAIzC,GACZwB,KAAKE,IAAI,CACPd,YAAY,EACZJ,eAAe,EACf6C,kBAAmBrD,MAIvBwB,KAAK0B,OACL1B,KAAK8B,2LAzISrC,+FASXJ,QAAa,kCAiBTH,KAAY,uDAWNE,gUAxBkC,qBANpCN,sBAAaC,yBAAWE,49BAS6Bc,ytBAhBlDN,kBASXJ,QAAQG,gIAOqDO,wBAUzDb,KAAKoC,+LAnBDxC,sCAAaC,8CAAWE,4SAGPA,uHAAAA,sFAmBJC,KAAKoC,iSAALpC,KAAKoC,kIAmBNpC,gBAAAA,2BAA8BE,4BAAAA,8bAA9BF,uBAAAA,mDAA8BE,mCAAAA,qGAJ9B,cALN2C,gCAAAA,2CACA7C,gBAAAA,2BACA2C,0CAAAA,qDACAxC,sBAAAA,iCACAD,4BAAAA,osBAJA2C,uCAAAA,yCACA7C,uBAAAA,wEACA2C,iDAAAA,uDACAxC,6BAAAA,sDACAD,mCAAAA"}