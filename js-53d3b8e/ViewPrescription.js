var K_ENV="prod",K_ENV_DEV="dev",K_ENV_TEST="test",K_ENV_PROD="prod";import{w as addListener,a as append,b as assign,c as assignTrue,z as createComment,d as createElement,f as createText,A as destroyEach,g as detachNode,h as flush,i as init,j as insert,l as proto,x as removeListener,B as setData,n as Icon,D as Panel,e as createFragment,m as removeFromStore,y as setAttribute,E as Notification,o as Message,q as ViewScaffold,r as PageTitle}from"./chunk-10c73911.js";import{a as Router}from"./chunk-47ccaf79.js";import{a as SearchableSelect}from"./chunk-84272e14.js";import{b as SubmitButton,a as ConfirmButton}from"./chunk-fd52a1b9.js";import{a as Remedies}from"./chunk-8a0ef651.js";import{a as Model}from"./chunk-2f526612.js";import{a as PatientDetails}from"./chunk-d48a9a71.js";import{a as TreatmentModel,b as AddTreatment}from"./chunk-f1318c00.js";function niceDate(e,t,a){var r=e instanceof Date;if(e&&(r||""!=e.trim())){var s=r?e:new Date(e.replace(/-/g,"/")),n=s.getDate();if(isNaN(n))return"";var i=n,d=s.getMonth()+1;if(i=(i=i<10?"0"+i:i)+"/"+(d=d<10?"0"+d:d)+"/"+s.getFullYear().toString(),t){var o=s.getHours(),c=s.getMinutes();i+=9==o&&0==c&&a?" AM":12==o&&0==c&&a?" PM":" "+(o=o<10?"0"+o:o)+":"+(c=c<10?"0"+c:c)}return i}return""}function today({history:e}){return new Date}function data(){return{history:[],visible:5,showAll:!1,filter:"",add_remedy:!1}}var methods={showAll(){this.set({showAll:!0})},edit(e){this.fire("editPrescription",e)}};function oncreate(){this.on("resetSearch",()=>{this.set({filter:""})})}function get_each_context_1(e,t,a){const r=Object.create(e);return r.remedy=t[a].remedy,r.power=t[a].power,r.taking_rule=t[a].taking_rule,r.i=a,r}function click_handler(e){const{component:t,ctx:a}=this._svelte;t.edit(a.item.remedies)}function get_each_context(e,t,a){const r=Object.create(e);return r.item=t[a],r}function create_main_fragment(e,t){var a,r,s,n,i,d,o,c=t.add_remedy?"Cancel":"Add More";function l(a){e.set({add_remedy:!t.add_remedy})}var m=null!=t.history&&void 0!==t.history.length&&t.history.length>0&&create_if_block(e,t);return{c(){a=createElement("p"),r=createText("Remedy History\r\n  "),s=createElement("span"),n=createElement("button"),i=createText(c),d=createText("\r\n\r\n"),o=createElement("div"),m&&m.c(),addListener(n,"click",l),n.className="button is-primary",n.type="button",s.className="is-pulled-right",a.className="title is-5"},m(e,t){insert(e,a,t),append(a,r),append(a,s),append(s,n),append(n,i),insert(e,d,t),insert(e,o,t),m&&m.m(o,null)},p(a,r){t=r,a.add_remedy&&c!==(c=t.add_remedy?"Cancel":"Add More")&&setData(i,c),null!=t.history&&void 0!==t.history.length&&t.history.length>0?m?m.p(a,t):((m=create_if_block(e,t)).c(),m.m(o,null)):m&&(m.d(1),m=null)},d(e){e&&detachNode(a),removeListener(n,"click",l),e&&(detachNode(d),detachNode(o)),m&&m.d()}}}function create_if_block(e,t){for(var a,r,s,n=t.history,i=[],d=0;d<n.length;d+=1)i[d]=create_each_block(e,get_each_context(t,n,d));var o=t.hasMoreItems&&create_if_block_1(e,t);return{c(){a=createElement("ul");for(var e=0;e<i.length;e+=1)i[e].c();r=createText("\r\n    "),o&&o.c(),s=createComment(),a.className="timeline"},m(e,t){insert(e,a,t);for(var n=0;n<i.length;n+=1)i[n].m(a,null);insert(e,r,t),o&&o.m(e,t),insert(e,s,t)},p(t,r){if(t.history||t.today){n=r.history;for(var d=0;d<n.length;d+=1){const s=get_each_context(r,n,d);i[d]?i[d].p(t,s):(i[d]=create_each_block(e,s),i[d].c(),i[d].m(a,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=n.length}r.hasMoreItems?o?o.p(t,r):((o=create_if_block_1(e,r)).c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},d(e){e&&detachNode(a),destroyEach(i,e),e&&detachNode(r),o&&o.d(e),e&&detachNode(s)}}}function create_if_block_2(e,t){var a,r;return{c(){a=createElement("span"),(r=createElement("button")).innerHTML='<span class="icon is-small"><i class="fa fa-pencil"></i></span>',r._svelte={component:e,ctx:t},addListener(r,"click",click_handler),r.type="button",r.className="button is-small",a.className="is-pulled-right"},m(e,t){insert(e,a,t),append(a,r)},p(e,a){t=a,r._svelte.ctx=t},d(e){e&&detachNode(a),removeListener(r,"click",click_handler)}}}function create_each_block_1(e,t){var a,r,s,n,i,d,o,c,l,m,_,p,h,u=t.remedy,f=t.power,y=t.taking_rule;return{c(){a=createElement("tr"),r=createElement("td"),s=createText(u),n=createText("\r\n                  "),i=createElement("td"),d=createText(f),o=createText("\r\n                  "),c=createElement("td"),l=createText(y),m=createText("\r\n                  "),_=createElement("td"),p=createText("\r\n                  "),h=createElement("td")},m(e,t){insert(e,a,t),append(a,r),append(r,s),append(a,n),append(a,i),append(i,d),append(a,o),append(a,c),append(c,l),append(a,m),append(a,_),append(a,p),append(a,h)},p(e,t){e.history&&u!==(u=t.remedy)&&setData(s,u),e.history&&f!==(f=t.power)&&setData(d,f),e.history&&y!==(y=t.taking_rule)&&setData(l,y)},d(e){e&&detachNode(a)}}}function create_each_block(e,t){for(var a,r,s,n,i,d,o,c,l,m,_=t.item.date,p=t.item.date==niceDate(t.today)&&create_if_block_2(e,t),h=t.item.remedies,u=[],f=0;f<h.length;f+=1)u[f]=create_each_block_1(e,get_each_context_1(t,h,f));return{c(){a=createElement("li"),r=createElement("span"),s=createElement("strong"),n=createText(_),i=createText("\r\n            "),p&&p.c(),d=createText("\r\n          "),o=createElement("span"),c=createElement("table");for(var e=0;e<u.length;e+=1)u[e].c();l=createText("\r\n            \r\n            "),m=createElement("br"),r.className="description",c.className="table has-background-warning-light",o.className="description"},m(e,t){insert(e,a,t),append(a,r),append(r,s),append(s,n),append(r,i),p&&p.m(r,null),append(a,d),append(a,o),append(o,c);for(var _=0;_<u.length;_+=1)u[_].m(c,null);append(o,l),append(o,m)},p(t,a){if(t.history&&_!==(_=a.item.date)&&setData(n,_),a.item.date==niceDate(a.today)?p?p.p(t,a):((p=create_if_block_2(e,a)).c(),p.m(r,null)):p&&(p.d(1),p=null),t.history){h=a.item.remedies;for(var s=0;s<h.length;s+=1){const r=get_each_context_1(a,h,s);u[s]?u[s].p(t,r):(u[s]=create_each_block_1(e,r),u[s].c(),u[s].m(c,null))}for(;s<u.length;s+=1)u[s].d(1);u.length=h.length}},d(e){e&&detachNode(a),p&&p.d(),destroyEach(u,e)}}}function create_if_block_1(e,t){var a,r,s,n,i,d,o,c,l,m,_,p=t.history.length-t.visible,h=new Icon({root:e.root,store:e.store,data:{icon:"chevron-down"}});function u(t){e.showAll()}return{c(){a=createElement("div"),r=createElement("div"),s=createElement("hr"),n=createText("\r\n        "),i=createElement("button"),h._fragment.c(),d=createText(" "),o=createElement("span"),c=createText("Show "),l=createElement("strong"),m=createText(p),_=createText(" more items"),addListener(i,"click",u),i.className="button is-info is-small is-fullwidth",i.type="button",r.className="column",a.className="columns"},m(e,t){insert(e,a,t),append(a,r),append(r,s),append(r,n),append(r,i),h._mount(i,null),append(i,d),append(i,o),append(o,c),append(o,l),append(l,m),append(o,_)},p(e,t){(e.history||e.visible)&&p!==(p=t.history.length-t.visible)&&setData(m,p)},d(e){e&&detachNode(a),h.destroy(),removeListener(i,"click",u)}}}function Timeline(e){init(this,e),this._state=assign(data(),e.data),this._recompute({history:1},this._state),this._intro=!0,this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(()=>{oncreate.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}function entityId({$nav:e}){return e&&e.params[0]}function filterFields({remedies:e,omitted_field:t}){let a=["built","constitution","diathesis","miasm","temperament","temperature_and_weather","thermal_sensitivity","sensation","tendency_take_cold","desires","aversions","birth_history_milestones","tissues","stages_and_states","attacks_and_side","ailments_from","affections","clinical","modalities","mental_state_and_disorders","appearance_and_behavior","attention_and_concentration","expression","consciousness","mood_and_affect","memory","speech","thoughts_and_ideas","perception","intelligence","judgment","fear_and_live_alone","boring","peaceful","anger","hobby","habit","addiction","nutrition","anaemia","cyanosis","dehydration","jaundice","pulse","breathing","peculiar_rare_symptoms"],r=[];if(e.length){for(let[s,n]of Object.entries(e[0]))a.includes(s)||t.includes(s)||r.push(s);return r.push(...a),r}}function prescribe_history({data:e}){if(e.treatments){const t=e.treatments.reduce((e,t)=>{const a=niceDate(t.created);return e[a]||(e[a]=[]),e[a].push(t),e},{});return Object.keys(t).map(e=>({date:e,remedies:t[e]}))}return[]}function remedy_names({remedies:e}){let t=[];for(let a in e){let r=e[a];t.push(r.name)}return t}function data$1(){return{is_loading:!1,is_error:!1,error_message:"",selected_symptom:"",remedies:{},data:{},meta:{},omitted_field:["id","name","created","modified","deleted","patient","treatments"],add_remedy:!1,tracker:{saving:!1,saved:!1,error:!1},page:{title:"View Prescription",subtitle:"Patients prescription details",icon:"building-o",icon_badge:"pencil"}}}assign(Timeline.prototype,proto),assign(Timeline.prototype,methods),Timeline.prototype._recompute=function(e,t){e.history&&this._differs(t.today,t.today=today(t))&&(e.today=!0)};var methods$1={select_symptom(e){this.set({selected_symptom:e})},load(){var{entityId:e}=this.get();this.set({is_loading:!0,is_error:!1}),Model&&Model.getOne(e).then(e=>{this.set({is_loading:!1,meta:e._meta,data:e.response})}).catch(e=>{var t="";void 0!==e&&void 0!==e.response&&void 0!==e.response.records&&(t=e.response.records.userMessage),this.set({is_error:!0,is_loading:!1,error_message:t})})},loadRemedies(){Remedies.getAll({limit:1e3}).then(e=>{this.set({remedies:e.response})}).catch(e=>{console.log(e)})},savePrescription(e){let{data:t,entityId:a}=this.get(),r={prescribe:{id:a,patient:t.patient.id},data:e};this.set({tracker:{saving:!0,saved:!1,error:!1}}),TreatmentModel.createWithCase(r).then(e=>{this.set({tracker:{saving:!1,saved:!0,error:!1}}),setTimeout(()=>{this.set({tracker:{saved:!1},add_remedy:!1}),this.load()},1500)}).catch(e=>{console.log(e)})}};function oncreate$1(){var{entityId:e}=this.get();this.on("saveTreatment",e=>{this.savePrescription(e)}),this.on("editPrescription",e=>{console.log(e),this.set({add_remedy:!0,selected_remedies:e})}),this.load(),this.loadRemedies()}function create_main_fragment$1(e,t){var a,r,s,n,i,d,o,c,l,m,_,p,h,u,f,y,g,v,b,k,T=new Icon({root:e.root,store:e.store,data:{icon:"long-arrow-left",size:"small"}}),E={page:t.page},N=new PageTitle({root:e.root,store:e.store,slots:{default:createFragment()},data:E}),x=t.tracker.error&&create_if_block_2$1(e,t),w=t.data.patient&&create_if_block_1$1(e,t);function P(e){return e.add_remedy?create_if_block$1:create_else_block}var D=P(t),$=D(e,t),M=new Message({root:e.root,store:e.store,slots:{default:createFragment()},data:{color:"light",size:"large"}}),I=new Panel({root:e.root,store:e.store,slots:{default:createFragment(),toolbar:createFragment()},data:{title:"Prescription Details",has_toolbar:!0}}),j={is_loading:t.is_loading,is_error:t.is_error,error_message:t.error_message},A=new ViewScaffold({root:e.root,store:e.store,slots:{default:createFragment()},data:j});return{c(){a=createElement("div"),r=createElement("a"),T._fragment.c(),s=createText("\r\n      "),(n=createElement("span")).textContent="Back to All Prescriptions",N._fragment.c(),i=createText("\r\n\r\n  "),x&&x.c(),d=createText("\r\n    \r\n    "),o=createElement("div"),c=createElement("a"),(l=createElement("span")).innerHTML='<i class="fa fa-eye"></i>',m=createText("\r\n          "),(_=createElement("span")).textContent="View case history",h=createText("\r\n      \r\n      "),u=createElement("div"),f=createElement("div"),w&&w.c(),y=createText("\r\n        "),g=createElement("div"),v=createElement("div"),b=createElement("div"),$.c(),k=createComment(),M._fragment.c(),I._fragment.c(),A._fragment.c(),r.className="button is-info is-pulled-right",r.href="#prescriptions",l.className="icon is-small",setAttribute(c,"type","button"),c.className="button is-gray",c.href=p="/#history/view/"+t.entityId,setAttribute(o,"slot","toolbar"),f.className="column",b.className="column",v.className="columns",g.className="column",u.className="columns",a.className="page-content"},m(e,t){insert(e,a,t),append(N._slotted.default,r),T._mount(r,null),append(r,s),append(r,n),N._mount(a,null),append(a,i),x&&x.m(A._slotted.default,null),append(A._slotted.default,d),append(I._slotted.toolbar,o),append(o,c),append(c,l),append(c,m),append(c,_),append(I._slotted.default,h),append(I._slotted.default,u),append(u,f),w&&w.m(f,null),append(u,y),append(u,g),append(g,v),append(v,b),$.m(M._slotted.default,null),append(M._slotted.default,k),M._mount(b,null),I._mount(A._slotted.default,null),A._mount(a,null)},p(t,a){var r={};t.page&&(r.page=a.page),N._set(r),a.tracker.error?x?x.p(t,a):((x=create_if_block_2$1(e,a)).c(),x.m(d.parentNode,d)):x&&(x.d(1),x=null),t.entityId&&p!==(p="/#history/view/"+a.entityId)&&(c.href=p),a.data.patient?w?w.p(t,a):((w=create_if_block_1$1(e,a)).c(),w.m(f,null)):w&&(w.d(1),w=null),D===(D=P(a))&&$?$.p(t,a):($.d(1),($=D(e,a)).c(),$.m(k.parentNode,k));var s={};t.is_loading&&(s.is_loading=a.is_loading),t.is_error&&(s.is_error=a.is_error),t.error_message&&(s.error_message=a.error_message),A._set(s)},d(e){e&&detachNode(a),T.destroy(),N.destroy(),x&&x.d(),w&&w.d(),$.d(),M.destroy(),I.destroy(),A.destroy()}}}function create_if_block_2$1(e,t){var a,r=new Notification({root:e.root,store:e.store,slots:{default:createFragment()},data:{type:"danger"}});return{c(){a=createText(t.error_message),r._fragment.c()},m(e,t){append(r._slotted.default,a),r._mount(e,t)},p(e,t){e.error_message&&setData(a,t.error_message)},d(e){r.destroy(e)}}}function create_if_block_1$1(e,t){var a,r,s={data:t.data.patient},n=new PatientDetails({root:e.root,store:e.store,data:s});return{c(){(a=createElement("p")).textContent="Patient Details",r=createText("\r\n\r\n        "),n._fragment.c(),a.className="title is-5"},m(e,t){insert(e,a,t),insert(e,r,t),n._mount(e,t)},p(e,t){var a={};e.data&&(a.data=t.data.patient),n._set(a)},d(e){e&&(detachNode(a),detachNode(r)),n.destroy(e)}}}function create_else_block(e,t){var a={},r={history:t.prescribe_history};void 0!==t.add_remedy&&(r.add_remedy=t.add_remedy,a.add_remedy=!0);var s=new Timeline({root:e.root,store:e.store,data:r,_bind(t,r){var s={};!a.add_remedy&&t.add_remedy&&(s.add_remedy=r.add_remedy),e._set(s),a={}}});return e.root._beforecreate.push(()=>{s._bind({add_remedy:1},s.get())}),s.on("editPrescription",function(t){e.fire("editPrescription",t)}),{c(){s._fragment.c()},m(e,t){s._mount(e,t)},p(e,r){t=r;var n={};e.prescribe_history&&(n.history=t.prescribe_history),!a.add_remedy&&e.add_remedy&&(n.add_remedy=t.add_remedy,a.add_remedy=void 0!==t.add_remedy),s._set(n),a={}},d(e){s.destroy(e)}}}function create_if_block$1(e,t){var a={},r={prescribe:!0};void 0!==t.remedy_names&&(r.remedy_names=t.remedy_names,a.remedy_names=!0),void 0!==t.data&&(r.data=t.data,a.data=!0),void 0!==t.selected_remedies&&(r.selected_remedies=t.selected_remedies,a.selected_remedies=!0),void 0!==t.tracker&&(r.tracker=t.tracker,a.tracker=!0),void 0!==t.add_remedy&&(r.add_remedy=t.add_remedy,a.add_remedy=!0);var s=new AddTreatment({root:e.root,store:e.store,data:r,_bind(t,r){var s={};!a.remedy_names&&t.remedy_names&&(s.remedy_names=r.remedy_names),!a.data&&t.data&&(s.data=r.data),!a.selected_remedies&&t.selected_remedies&&(s.selected_remedies=r.selected_remedies),!a.tracker&&t.tracker&&(s.tracker=r.tracker),!a.add_remedy&&t.add_remedy&&(s.add_remedy=r.add_remedy),e._set(s),a={}}});return e.root._beforecreate.push(()=>{s._bind({remedy_names:1,data:1,selected_remedies:1,tracker:1,add_remedy:1},s.get())}),s.on("saveTreatment",function(t){e.fire("saveTreatment",t)}),{c(){s._fragment.c()},m(e,t){s._mount(e,t)},p(e,r){t=r;var n={};!a.remedy_names&&e.remedy_names&&(n.remedy_names=t.remedy_names,a.remedy_names=void 0!==t.remedy_names),!a.data&&e.data&&(n.data=t.data,a.data=void 0!==t.data),!a.selected_remedies&&e.selected_remedies&&(n.selected_remedies=t.selected_remedies,a.selected_remedies=void 0!==t.selected_remedies),!a.tracker&&e.tracker&&(n.tracker=t.tracker,a.tracker=void 0!==t.tracker),!a.add_remedy&&e.add_remedy&&(n.add_remedy=t.add_remedy,a.add_remedy=void 0!==t.add_remedy),s._set(n),a={}},d(e){s.destroy(e)}}}function ViewPrescription(e){init(this,e),this._state=assign(assign(this.store._init(["nav"]),data$1()),e.data),this.store._add(this,["nav"]),this._recompute({$nav:1,remedies:1,omitted_field:1,data:1},this._state),this._intro=!0,this._handlers.destroy=[removeFromStore],this._fragment=create_main_fragment$1(this,this._state),this.root._oncreate.push(()=>{oncreate$1.call(this),this.fire("update",{changed:assignTrue({},this._state),current:this._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),flush(this))}assign(ViewPrescription.prototype,proto),assign(ViewPrescription.prototype,methods$1),ViewPrescription.prototype._recompute=function(e,t){e.$nav&&this._differs(t.entityId,t.entityId=entityId(t))&&(e.entityId=!0),(e.remedies||e.omitted_field)&&this._differs(t.filterFields,t.filterFields=filterFields(t))&&(e.filterFields=!0),e.data&&this._differs(t.prescribe_history,t.prescribe_history=prescribe_history(t))&&(e.prescribe_history=!0),e.remedies&&this._differs(t.remedy_names,t.remedy_names=remedy_names(t))&&(e.remedy_names=!0)};export default ViewPrescription;
//# sourceMappingURL=ViewPrescription.js.map
